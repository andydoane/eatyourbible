<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>Apostles Creed</title>

<style>

/* Global box sizing fix */
*, *::before, *::after {
    box-sizing: border-box;
}

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: "Baloo 2", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

#app {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* ---------- Slide System ---------- */
.slide {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    display: flex;
    flex-direction: column;
    min-height: 0;   /* iOS Safari flex fix */
}

.content {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;   /* iOS Safari flex fix */
}

.image-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    min-height: 0;
}

.image-area img {
    max-height: 100%;
    max-width: min(90vw, 520px);
    object-fit: contain;
}

.text-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 20px;
    text-align: center;
    min-height: 0;
}

.phrase {
    font-family: 'Baloo 2', cursive;
    font-size: clamp(24px, 8vw, 100px);
    text-wrap: balance;
    color: white;
    font-weight: 700;
    text-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

/* Use on light backgrounds (yellow/white) */
.dark-text {
    color: #111;
    text-shadow: none;
}

.small-text {
    font-size: clamp(16px, 3vw, 20px);
    opacity: .85;
    color: white;
    text-wrap: balance;
}

.large-text {
    font-size: clamp(28px, 6vw, 48px);
    color: white;
    font-weight: 700;
    text-wrap: balance;
}

/* ---------- Navigation ---------- */

.nav {
    height: 70px;
    background: rgba(0,0,0,0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 30px;
    color: white;
    font-size: 28px;
}

.nav button {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
}

/* SVG icon sizing inside nav buttons */
.nav-icon {
    width: 34px;
    height: 34px;
    display: block;
}

.nav button {
    display: flex;
    align-items: center;
    justify-content: center;
}

.center-btn {
    font-size: 18px !important;
}

/* ---------- Title ---------- */

.title-screen {
    position: relative;           /* IMPORTANT: allows the footer to dock inside */
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    padding: 24px 16px;
    padding-bottom: 110px;        /* IMPORTANT: reserves space for the docked footer */
    background: #7f66c6;
    color: white;
    text-align: center;
}

.title-content {
    flex: 1;                      /* takes available space */
    display: flex;
    flex-direction: column;
    justify-content: center;      /* centers vertically */
    align-items: center;
    width: 100%;
    max-width: 700px;             /* nice on desktop */
    padding-bottom: 0px;         /* breathing room above footer */
}

.title-screen h2 {
    font-size: clamp(22px, 5.2vw, 44px);
    font-weight: 700;
    margin: 14px 0 12px;
    text-wrap: balance;
}

.title-screen img {
    width: min(80%, 420px);
    max-height: 34vh;   /* prevents it from eating the whole screen */
    object-fit: contain;
}

.title-buttons button {
    margin: 10px 8px;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 700;

    border-radius: 999px;              /* pill shape */
    border: none;

    background: white;
    color: #7f66c6;

    box-shadow: 0 6px 0 rgba(0,0,0,0.25);
    transition: all 0.15s ease;
}

.title-buttons button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 0 rgba(0,0,0,0.25);
}

.title-buttons button:active {
    transform: translateY(4px);
    box-shadow: 0 2px 0 rgba(0,0,0,0.25);
}

.learn-btn {
    background: white;
    color: #7f66c6;
}

.test-btn {
    background: #ffc751;
    color: #333;
}

/* ---------- Title Button Carousel ---------- */

.title-carousel {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
}

.title-buttons button.carousel-arrow {
    width: 54px;
    height: 54px;
    padding: 0;
    margin: 10px 0;
    border-radius: 999px;

    background: rgba(0,0,0,0.30);
    color: white;

    display: flex;              /* ✅ center the SVG */
    align-items: center;
    justify-content: center;
    line-height: 0;             /* ✅ remove baseline weirdness */
    font-size: 28px;
    font-weight: 700;
}

.title-buttons button.carousel-main {
    margin: 10px 0;
    flex: 1;                   /* ✅ take remaining space */
    min-width: 0;              /* ✅ allow shrinking on small screens */
    max-width: 420px;          /* ✅ still nice on desktop */
}

/* Dots under the carousel */
.carousel-dots {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 6px;
}

.carousel-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,0.75);
    opacity: 0.9;
}

.carousel-dot.active {
    background: rgba(255,255,255,0.95);
}

/* ---------- Mode Select (title-style buttons) ---------- */

.mode-buttons {
    display: flex;
    flex-direction: column;   /* stack buttons */
    align-items: center;
    width: 100%;
    gap: 14px;
    margin-top: 10px;
}

.mode-buttons button {
    width: min(420px, 92%);
    display: flex;
    flex-direction: column;   /* title + description */
    gap: 4px;
    line-height: 1.1;
}

.mode-buttons .btn-desc {
    font-size: 14px;
    font-weight: 500;
    opacity: 0.85;
}

/* third color option for Hard */
.hard-btn {
    background: #ff5a51;
    color: white;
}

.footer {
    position: absolute;           /* dock it */
    left: 0;
    right: 0;
    bottom: 0;

    background: rgba(0,0,0,0.30); /* matches your nav style */
    color: white;
    text-align: center;

    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    font-size: 14px;
    line-height: 1.2;
    z-index: 9999;
}

/* ---------- Intro ---------- */

.intro {
    background: #7f66c6;
    display: flex;  
    justify-content: center;
    align-items: center;
    height: 100%;
}

.intro img {
    width: 60%;
    max-width: 400px;
    animation: wiggle 1s infinite alternate;
}

@keyframes wiggle {
    0% { transform: rotate(-4deg); }
    100% { transform: rotate(4deg); }
}

/* ---------- Mode Screen ---------- */

.mode-screen {
    height: 100%;
    display: flex;
    flex-direction: column;
    color: white;
    text-align: center;
}

.mode-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 20px;
}

.mode-section h2 {
    margin: 0;
    font-size: 32px;
}

.mode-section p {
    margin-top: 10px;
}

.easy { background:#a7cb6f; }
.medium { background:#ffa351; }
.hard { background:#ff5a51; }

button {
    cursor: pointer;
    font-family: inherit;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------- Data ---------- */

const phrases = [
["I believe in God", "believe", "God"],
["The Father Almighty", "Father", "Almighty"],
["Creator of Heaven and Earth", "Creator", "Earth"],
["I believe in Jesus Christ", "Jesus", "believe"],
["His Only Son, our Lord.", "Son", "Lord"],
["He was conceived by the Holy Spirit", "Spirit", "conceived"],
["and born of the virgin Mary.", "born", "Mary"],
["He suffered under Pontius Pilate", "suffered", "Pilate"],
["was crucified", "crucified"],
["died, and was buried.", "buried", "died"],
["He descended to the dead.", "dead", "descended"],
["On the third day", "third"],
["He rose from the dead.", "rose", "dead"],
["He ascended to heaven", "ascended", "heaven"],
["and is seated at the right hand", "seated", "right"],
["of God the Father Almighty.", "God", "Almighty"],
["From there he will come", "come", "there"],
["to judge", "judge"],
["the living and the dead.", "living", "dead"],
["I believe in the Holy Spirit", "Spirit", "believe"],
["the holy catholic church", "church", "holy"],
["the communion of saints", "communion", "saints"],
["the forgiveness of sins", "forgiveness", "sins"],
["the resurrection of the body", "resurrection", "body"],
["and the life everlasting.", "life", "everlasting"]
];

const slideColors = [
"#7f66c6", // 1 - purple
"#ffc751", // 2 - yellow
"#333333", // 3 - gray
"#ffa351", // 4 - orange
"#a7cb6f", // 5 - green
"#ff5a51", // 6 - red
"#ffc751", // 7 - yellow
"#40b9c5", // 8 - blue
"#ff5a51", // 9 - red
"#f2f2f2", // 10 - white
"#333333", // 11 - gray
"#ffa351", // 12 - orange
"#a7cb6f", // 13 - green
"#40b9c5", // 14 - blue
"#ffc751", // 15 - yellow
"#7f66c6", // 16 - purple
"#40b9c5", // 17 - blue
"#ffa351", // 18 - orange
"#7f66c6", // 19 - purple
"#ffc751", // 20 - yellow
"#f2f2f2", // 21 - white
"#a7cb6f", // 22 - green
"#ff5a51", // 23 - red
"#a7cb6f", // 24 - green
"#7f66c6"  // 25 - purple
];

let screen="intro";
let index=0;
let muted=false;
let testMode=null;
let hintState=0;
let learnIntro = false;  // true only on the "Begin" screen
let isSliding = false;   // prevents overlapping slide animations

// ---------- Title carousel ----------
let titleOptionIndex = 0;

const TITLE_OPTIONS = [
    { label: "Learn the Verse", btnClass: "learn-btn", action: "startLearn" },
    { label: "Test Yourself",   btnClass: "test-btn",  action: "modeSelect" },
    { label: "Bible Verses",    btnClass: "learn-btn", action: "comingSoonVerses" } // placeholder
];

function comingSoonVerses(){
    alert("Coming soon! This will link each part of the Creed to Bible verses.");
}

function titlePrevOption(){
    titleOptionIndex = (titleOptionIndex - 1 + TITLE_OPTIONS.length) % TITLE_OPTIONS.length;
    updateTitleCarouselUI();
}

function titleNextOption(){
    titleOptionIndex = (titleOptionIndex + 1) % TITLE_OPTIONS.length;
    updateTitleCarouselUI();
}

function runTitleOption(){
    const opt = TITLE_OPTIONS[titleOptionIndex];
    // Call the function named in opt.action
    window[opt.action]();
}

function updateTitleCarouselUI(){
    const opt = TITLE_OPTIONS[titleOptionIndex];

    const mainBtn = document.getElementById("titleMainBtn");
    const indicator = document.getElementById("titleIndicator");

    if (mainBtn){
        mainBtn.textContent = opt.label;
        mainBtn.className = `carousel-main ${opt.btnClass}`;
    }
    if (indicator){
        indicator.innerHTML = TITLE_OPTIONS.map((_, i) =>
            `<span class="carousel-dot ${i === titleOptionIndex ? "active" : ""}"></span>`
        ).join("");
    }
}

// --- Inline SVG icons (from your uploaded SVGs) ---
const SVG_BACK = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path style="fill:#ffffff;stroke-width:74.9031;stroke-linecap:round"
    d="M 90.101697,426.07323 665.52324,88.164306 a 20.830539,20.830539 29.78848 0 1 31.37872,17.962384 v 676.74658 a 20.830539,20.830539 150.21152 0 1 -31.37872,17.96238 L 90.101697,462.92673 a 21.369052,21.369052 90 0 1 0,-36.8535 z"
    transform="translate(246.77226)" />
</svg>`;

const SVG_FORWARD = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path style="fill:#ffffff;stroke-width:74.9031;stroke-linecap:round"
    d="M 90.101697,426.07323 665.52324,88.164306 a 20.830539,20.830539 29.78848 0 1 31.37872,17.962384 v 676.74658 a 20.830539,20.830539 150.21152 0 1 -31.37872,17.96238 L 90.101697,462.92673 a 21.369052,21.369052 90 0 1 0,-36.8535 z"
    transform="matrix(-1,0,0,1,1023.2277,0)" />
</svg>`;

const SVG_MUTE = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path style="fill:#ffffff;stroke:none;stroke-width:44.9431;stroke-linecap:round"
    d="M 660.98465,87.244161 409.97079,241.6972 a 150.47802,150.47802 0 0 1 -78.85883,22.31829 H 225.63234 a 42.587633,42.587633 0 0 0 -42.58762,42.58762 v 275.79372 a 42.587633,42.587633 0 0 0 42.58762,42.58762 h 105.47962 a 150.47802,150.47802 0 0 1 78.85883,22.3183 l 251.01386,154.45304 a 23.799138,23.799138 0 0 0 36.27121,-20.26933 V 107.51349 A 23.799138,23.799138 0 0 0 660.98465,87.244161 Z" />
  <g transform="translate(-26.458334,-255.59263)">
    <path style="fill:none;stroke:#ffffff;stroke-width:76.7747;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="M 1241.4124,524.69155 890.61025,875.49365" />
    <path style="fill:none;stroke:#ffffff;stroke-width:76.7747;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="m 890.61025,524.69155 350.80215,350.8021" />
  </g>
</svg>`;

const SVG_UNMUTE = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <g transform="matrix(2.9017243,0,0,2.9017243,-948.59169,1423.6267)">
    <path style="fill:#ffffff;stroke:none;stroke-width:15.4884;stroke-linecap:round"
      d="m 554.69651,-460.54773 -86.50507,53.22802 a 51.858137,51.858137 0 0 1 -27.17654,7.69139 h -36.35067 a 14.676664,14.676664 0 0 0 -14.67666,14.67666 v 95.04477 a 14.676664,14.676664 0 0 0 14.67666,14.67666 h 36.35067 a 51.858137,51.858137 0 0 1 27.17654,7.69139 l 86.50507,53.22802 a 8.2017227,8.2017227 0 0 0 12.49988,-6.98527 v -232.26637 a 8.2017227,8.2017227 0 0 0 -12.49988,-6.98527 z" />
    <path style="fill:none;stroke:#ffffff;stroke-width:26.4583;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="m 596.38634,-270.01659 c 26.00162,-13.81364 42.0863,-39.52797 42.16745,-67.41243 -0.0102,-27.95044 -16.10446,-53.75052 -42.16745,-67.5969" />
    <path style="fill:none;stroke:#ffffff;stroke-width:26.4583;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="m 626.65943,-233.57231 c 4.34269,-2.51562 16.69789,-10.99898 23.86366,-17.76894 23.32002,-22.03191 37.74343,-52.46821 37.74343,-86.08777 0,-33.61956 -14.42341,-64.05637 -37.74343,-86.08828 -7.16577,-6.76996 -19.52097,-15.25332 -23.86366,-17.76894" />
  </g>
</svg>`;


// Reuse one audio player (important for iPhone autoplay behavior)
const audioPlayer = new Audio();
audioPlayer.preload = "auto";

// After we "unlock" once, later plays are more reliable
let audioUnlocked = false;

/* ---------- Utility ---------- */

function getColor(i){
    return slideColors[i];
}

function isLightBg(color){
    return color === "#ffc751" || color === "#f2f2f2";
}

function preloadCreedImages(){
    // Preload all slide images so iOS Safari has them ready
    for (let i = 1; i <= phrases.length; i++){
        const img = new Image();
        img.src = `creed_images/creed_${String(i).padStart(2,"0")}.png`;
    }

    // Also preload commonly used screens
    ["creed_title.png", "creed_end.png"].forEach(name => {
        const img = new Image();
        img.src = `creed_images/${name}`;
    });
}

function setupKeyboardNav(){
    document.addEventListener("keydown", (e) => {
        // Don’t spam-move if someone holds the key down
        if (e.repeat) return;

        // Only care about Left/Right arrows
        if (e.key !== "ArrowRight" && e.key !== "ArrowLeft") return;

        // Prevent the browser from scrolling the page
        e.preventDefault();

        // Right arrow = forward
        if (e.key === "ArrowRight") {
            if (screen === "learn") {
                // On the Begin screen, start the lesson (don’t skip phrase 1)
                if (learnIntro) nextLearn("forward");
                else forwardLearn();
            } else if (screen === "test") {
                forwardTest();
            }
            return;
        }

        // Left arrow = back
        if (e.key === "ArrowLeft") {
            if (screen === "learn") {
                // On Begin screen, go back to title
                if (learnIntro) titleScreen();
                else prevLearn();
            } else if (screen === "test") {
                prevTest();
            }
        }
    });
}

function playAudio(i){
    if (muted) return;

    audioPlayer.pause();
    audioPlayer.currentTime = 0;
    audioPlayer.src = `creed_audio/creed_${String(i+1).padStart(2,"0")}.mp3`;
    audioPlayer.volume = 1;

    audioPlayer.play().catch(()=>{});
}

function unlockAudioForIOS() {
    if (audioUnlocked) return;

    // Use slide 1 as the unlock source (must exist)
    audioPlayer.src = `creed_audio/creed_01.mp3`;
    audioPlayer.volume = 0;

    // Try to start playback during the user's tap
    const p = audioPlayer.play();
    if (p && typeof p.then === "function") {
        p.then(() => {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.volume = 1;
            audioUnlocked = true;
        }).catch(() => {
            // If it fails, we'll still be fine on later user-gesture plays
        });
    }
}


function maskWord(word, revealLetters=0){
    return word.split("").map((c,i)=>{
        if(c===" ") return " ";
        if(i<revealLetters) return word[i];
        return "_";
    }).join("");
}

function maskPhrase(phrase, removeWords, reveal=0){
    let result=phrase;
    removeWords.forEach(w=>{
        const masked = reveal===2 ? w :
                       reveal===1 ? maskWord(w,1) :
                       maskWord(w,0);
        result = result.replace(new RegExp(w,"i"), masked);
    });
    return result;
}

function computeTestDisplayPhrase() {
    const phraseData = phrases[index];
    const phrase = phraseData[0];

    let remove = [];
    if (testMode === "easy") remove = [phraseData[1]];
    if (testMode === "medium") remove = phraseData.slice(1);

    if (testMode === "hard" && hintState === 0) return "";
    if (testMode === "hard" && hintState === 1) return maskPhrase(phrase, phraseData.slice(1), 0);
    if (testMode === "hard" && hintState === 2) return phrase;

    return maskPhrase(phrase, remove, hintState);
}

function updateTestHintUI() {
    const phraseEl = document.getElementById("testPhrase");
    if (phraseEl) phraseEl.textContent = computeTestDisplayPhrase();

    const hintBtn = document.getElementById("hintBtn");
    if (hintBtn) hintBtn.textContent = (hintState === 0) ? "Hint" : "Reveal";
}

/* ---------- Slide Engine ---------- */

function showSlide(contentHTML, bgColor, direction = "forward") {
    const app = document.getElementById("app");

    // Remove any non-slide screens (like title/mode screens)
    [...app.children].forEach(child => {
        if (!child.classList || !child.classList.contains("slide")) child.remove();
    });

    // If we are mid-animation, ignore new slide requests
    if (direction !== "none" && isSliding) return;

    // Get ALL slides currently in the DOM
    const slides = app.querySelectorAll(".slide");
    const oldSlide = slides.length ? slides[slides.length - 1] : null;

    // If any extra slides exist (shouldn't, but can happen), remove them
    for (let i = 0; i < slides.length - 1; i++) {
        slides[i].remove();
    }

    const newSlide = document.createElement("div");
    newSlide.className = "slide";
    newSlide.style.background = bgColor;
    newSlide.innerHTML = contentHTML;
    newSlide.style.transition = "none";

    // Starting positions based on direction
    if (direction === "back") {
        newSlide.style.transform = "translateX(-100%)";
    } else if (direction === "none") {
        newSlide.style.transform = "translateX(0)";
    } else {
        newSlide.style.transform = "translateX(100%)";
    }

    app.appendChild(newSlide);
    newSlide.offsetHeight; // force layout so the starting transform is committed

    // If no animation requested, just remove old and finish
    if (direction === "none") {
        if (oldSlide) oldSlide.remove();
        isSliding = false;
        return;
    }

    isSliding = true;

    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            newSlide.style.transition = "transform .4s ease";
            newSlide.style.transform = "translateX(0)";

            if (oldSlide) {
                oldSlide.style.transition = "transform .4s ease";
                oldSlide.style.transform = (direction === "back")
                    ? "translateX(100%)"
                    : "translateX(-100%)";
            }

            setTimeout(() => {
                if (oldSlide) oldSlide.remove();
                isSliding = false;
            }, 410);
        });
    });
}


/* ---------- Screens ---------- */

function introScreen(){
    const html=`
    <div class="intro">
        <img id="introImg" src="creed_images/intro_bible.png">
    </div>`;
    document.getElementById("app").innerHTML=html;

    const img=document.getElementById("introImg");
    img.onclick=()=>{
        img.src="creed_images/intro_bible_bite.png";
        new Audio("creed_audio/chomp.mp3").play();
        setTimeout(()=>titleScreen(),600);
    };
}

function titleScreen(){
    screen="title";
    const html=`
    <div class="title-screen">
        <div class="title-content" id="titleContent">
            <img src="creed_images/creed_title.png">
            <h2>Let's learn the Apostle's Creed</h2>
        <div class="title-buttons">
            <div class="title-carousel">
                <button class="carousel-arrow" onclick="titlePrevOption()" aria-label="Previous option">◀</button>


                <button id="titleMainBtn" class="carousel-main learn-btn" onclick="runTitleOption()">
                    Learn the Verse
                </button>

                <button class="carousel-arrow" onclick="titleNextOption()" aria-label="Next option">▶</button>
            </div>

            <div class="carousel-dots" id="titleIndicator"></div>
        </div>
        </div>
        <div class="footer">
            More free Bible resources at:<br>
            <a href="https://www.eatyourbible.com" target="_blank" style="color:white;">
            www.eatyourbible.com</a>
        </div>
    </div>`;
    document.getElementById("app").innerHTML=html;
    updateTitleCarouselUI();
}

function startLearn(){
    unlockAudioForIOS();   // <--- add this line
    screen="learn";
    index=0;
    showLearnIntro();
}


function showLearnIntro(){
    learnIntro = true;
    showSlide(`
    <div class="content">
        <div class="text-area">
            <div>
                <div class="large-text">Let's read the Apostles Creed.</div>
                <div class="small-text">Use the arrows to go forward and back.</div>

                <div class="title-buttons">
                    <button class="learn-btn" onclick="nextLearn('forward')">Begin</button>
                </div>
            </div>
        </div>
        <div class="nav"></div>
    </div>`, "#7f66c6");
}

function nextLearn(direction = "forward"){
    learnIntro = false;
    if(index>=phrases.length){
        showLearnEnd();
        return;
    }
    const phrase=phrases[index][0];
    const color=getColor(index);
    const textClass = isLightBg(color) ? "phrase dark-text" : "phrase";
    const html=`
    <div class="content">
        <div class="image-area" onclick="forwardLearn()">
            <img src="creed_images/creed_${String(index+1).padStart(2,"0")}.png">
        </div>
        <div class="text-area">
            <div class="${textClass}">${phrase}</div>
        </div>
    </div>
    <div class="nav">
        <button onclick="prevLearn()" aria-label="Back">${SVG_BACK}</button>
        <button class="center-btn" id="muteBtn" onclick="toggleMute()" aria-label="Mute toggle">
            ${muted ? SVG_MUTE : SVG_UNMUTE}
        </button>
        <button onclick="forwardLearn()" aria-label="Forward">${SVG_FORWARD}</button>
    </div>`;
    showSlide(html, color, direction);
    playAudio(index);
}

function forwardLearn(){
    index++;
    nextLearn("forward");
}

function prevLearn(){
    if(index>0){
        index--;
        nextLearn("back");
    }
}



function toggleMute(){
    muted = !muted;
    const btn = document.getElementById("muteBtn");
    if (btn) btn.innerHTML = muted ? SVG_MUTE : SVG_UNMUTE;
}


function showLearnEnd(){
    const html=`
    <div class="title-screen">
        <div class="title-content">
            <img src="creed_images/creed_end.png">
            <h2>Great job!</h2>
            <div class="title-buttons">
                <button class="learn-btn" onclick="titleScreen()">Title Screen</button>
                <button class="test-btn" onclick="modeSelect()">Test Yourself</button>
            </div>
        </div>

        <div class="footer">
            More free Bible resources at:<br>
            <a href="https://www.eatyourbible.com" target="_blank" style="color:white;">
            www.eatyourbible.com</a>
        </div>
    </div>`;
    showSlide(html, "#7f66c6");
}

/* ---------- Test Mode ---------- */

function modeSelect(){
    screen="mode";
    const html=`
    <div class="title-screen">
        <div class="title-content">
            <h2>Choose a mode</h2>

            <div class="title-buttons mode-buttons">
                <button class="learn-btn" onclick="startTest('easy')">
                    Easy
                    <span class="btn-desc">Guess 1 missing word</span>
                </button>

                <button class="test-btn" onclick="startTest('medium')">
                    Medium
                    <span class="btn-desc">More words go missing</span>
                </button>

                <button class="hard-btn" onclick="startTest('hard')">
                    Hard
                    <span class="btn-desc">Images only (no text)</span>
                </button>

                <button class="learn-btn" onclick="titleScreen()">
                    Back to Title
                </button>
            </div>
        </div>

        <div class="footer">
            More free Bible resources at:<br>
            <a href="https://www.eatyourbible.com" target="_blank" style="color:white;">
            www.eatyourbible.com</a>
        </div>
    </div>`;
    document.getElementById("app").innerHTML=html;
}



function startTest(mode){
    screen="test";
    testMode=mode;
    index=0;
    hintState=0;
    nextTest();
}

function nextTest(){
    if(index>=phrases.length){
        showTestEnd();
        return;
    }
    hintState=0;
    renderTest();
}

function renderTest(direction = "forward"){
    const phraseData=phrases[index];
    const phrase=phraseData[0];
    let remove=[];
    if(testMode==="easy") remove=[phraseData[1]];
    if(testMode==="medium") remove=phraseData.slice(1);
    let displayPhrase=phrase;

    if(testMode==="hard" && hintState===0){
        displayPhrase="";
    } else if(testMode==="hard" && hintState===1){
        displayPhrase=maskPhrase(phrase,phraseData.slice(1),0);
    } else if(testMode==="hard" && hintState===2){
        displayPhrase=phrase;
    } else {
        displayPhrase=maskPhrase(phrase,remove,hintState);
    }

    const color=getColor(index);
    const textClass = isLightBg(color) ? "phrase dark-text" : "phrase";
    const html=`
    <div class="content">
        <div class="image-area" onclick="forwardTest()">
            <img src="creed_images/creed_${String(index+1).padStart(2,"0")}.png">
        </div>
        <div class="text-area">
            <div class="${textClass}" id="testPhrase">${displayPhrase}</div>
        </div>
    </div>
    <div class="nav">
        <button onclick="prevTest()" aria-label="Back">${SVG_BACK}</button>
        <button class="center-btn" id="hintBtn" onclick="hint()">${hintState===0?"Hint":"Reveal"}</button>
        <button onclick="forwardTest()" aria-label="Forward">${SVG_FORWARD}</button>
    </div>`;
showSlide(html, color, direction);
}

function hint(){
    if (hintState < 2) hintState++;
    updateTestHintUI(); // no animation
}

function forwardTest(){
    index++;
    hintState = 0; // reset Hint/Reveal for the new page

    // if we went past the last phrase, go to the end screen
    if (index >= phrases.length) {
        showTestEnd();
        return;
    }

    renderTest("forward");
}

function prevTest(){
    if(index > 0){
        index--;
        hintState = 0; // reset Hint/Reveal for the new page
        renderTest("back");
    }
}



function showTestEnd(){
    const html=`
    <div class="title-screen">
        <div class="title-content">
            <img src="creed_images/creed_end.png">
            <h2>Great job!</h2>
            <div class="title-buttons">
                <button class="learn-btn" onclick="modeSelect()">Change Mode</button>
                <button class="test-btn" onclick="titleScreen()">Title Screen</button>
            </div>
        </div>

        <div class="footer">
            More free Bible resources at:<br>
            <a href="https://www.eatyourbible.com" target="_blank" style="color:white;">
            www.eatyourbible.com</a>
        </div>
    </div>`;
    showSlide(html, "#7f66c6");
}



/* ---------- Start ---------- */
setupKeyboardNav();
preloadCreedImages();
introScreen();
</script>
</body>
</html>
