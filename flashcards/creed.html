<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>Apostles Creed</title>

<style>

/* Global box sizing fix */
*, *::before, *::after {
    box-sizing: border-box;
}

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: "Baloo 2", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

#app {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

/* ---------- Slide System ---------- */

.slide {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    display: flex;
    flex-direction: column;
}

.content {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.image-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}

.image-area img {
    max-height: 100%;
    max-width: min(90vw, 520px);
    object-fit: contain;
}

.text-area {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 20px;
    text-align: center;
}

.phrase {
    font-family: 'Baloo 2', cursive;
    font-size: clamp(24px, 5vw, 42px);
    text-wrap: balance;
    color: white;
    font-weight: 700;
    text-shadow: 0 2px 6px rgba(0,0,0,0.4);
}

.small-text {
    font-size: clamp(16px, 3vw, 20px);
    opacity: .85;
    color: white;
}

.large-text {
    font-size: clamp(28px, 6vw, 48px);
    color: white;
    font-weight: 700;
}

/* ---------- Navigation ---------- */

.nav {
    height: 70px;
    background: rgba(0,0,0,0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 30px;
    color: white;
    font-size: 28px;
}

.nav button {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
}

/* SVG icon sizing inside nav buttons */
.nav-icon {
    width: 34px;
    height: 34px;
    display: block;
}

.nav button {
    display: flex;
    align-items: center;
    justify-content: center;
}

.center-btn {
    font-size: 18px !important;
}

/* ---------- Title ---------- */

.title-screen {
    position: relative;           /* IMPORTANT: allows the footer to dock inside */
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    padding: 24px 16px;
    padding-bottom: 110px;        /* IMPORTANT: reserves space for the docked footer */
    background: #7f66c6;
    color: white;
    text-align: center;
}

.title-content {
    flex: 1;                      /* takes available space */
    display: flex;
    flex-direction: column;
    justify-content: center;      /* centers vertically */
    align-items: center;
    width: 100%;
    max-width: 700px;             /* nice on desktop */
    padding-bottom: 0px;         /* breathing room above footer */
}

.title-screen h2 {
    font-size: clamp(22px, 5.2vw, 44px);
    font-weight: 700;
    margin: 14px 0 12px;
    text-wrap: balance;
}

.title-screen img {
    width: min(80%, 420px);
    max-height: 34vh;   /* prevents it from eating the whole screen */
    object-fit: contain;
}

.title-buttons button {
    margin: 10px 8px;
    padding: 14px 28px;
    font-size: 18px;
    font-weight: 700;

    border-radius: 999px;              /* pill shape */
    border: none;

    background: white;
    color: #7f66c6;

    box-shadow: 0 6px 0 rgba(0,0,0,0.25);
    transition: all 0.15s ease;
}

.title-buttons button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 0 rgba(0,0,0,0.25);
}

.title-buttons button:active {
    transform: translateY(4px);
    box-shadow: 0 2px 0 rgba(0,0,0,0.25);
}

.learn-btn {
    background: white;
    color: #7f66c6;
}

.test-btn {
    background: #ffc751;
    color: #333;
}

.footer {
    position: absolute;           /* dock it */
    left: 0;
    right: 0;
    bottom: 0;

    background: rgba(0,0,0,0.30); /* matches your nav style */
    color: white;
    text-align: center;

    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
    font-size: 14px;
    line-height: 1.2;
    z-index: 9999;
}

/* ---------- Intro ---------- */

.intro {
    background: #7f66c6;
    display: flex;  
    justify-content: center;
    align-items: center;
    height: 100%;
}

.intro img {
    width: 60%;
    max-width: 400px;
    animation: wiggle 1s infinite alternate;
}

@keyframes wiggle {
    0% { transform: rotate(-4deg); }
    100% { transform: rotate(4deg); }
}

/* ---------- Mode Screen ---------- */

.mode-screen {
    height: 100%;
    display: flex;
    flex-direction: column;
    color: white;
    text-align: center;
}

.mode-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 20px;
}

.mode-section h2 {
    margin: 0;
    font-size: 32px;
}

.mode-section p {
    margin-top: 10px;
}

.easy { background:#a7cb6f; }
.medium { background:#ffa351; }
.hard { background:#ff5a51; }

button {
    cursor: pointer;
    font-family: inherit;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
/* ---------- Data ---------- */

const phrases = [
["I believe in God", "believe", "God"],
["The Father Almighty", "Father", "Almighty"],
["Creator of Heaven and Earth", "Creator", "Earth"],
["I believe in Jesus Christ", "Jesus", "believe"],
["His Only Son, our Lord.", "Son", "Lord"],
["He was conceived by the Holy Spirit", "Spirit", "conceived"],
["and born of the virgin Mary.", "born", "Mary"],
["He suffered under Pontius Pilate", "suffered", "Pilate"],
["was crucified", "crucified"],
["died, and was buried.", "buried", "died"],
["He descended to the dead.", "dead", "descended"],
["On the third day", "third"],
["He rose from the dead.", "rose", "dead"],
["He ascended to heaven", "ascended", "heaven"],
["and is seated at the right hand", "seated", "right"],
["of God the Father Almighty.", "God", "Almighty"],
["From there he will come", "come", "there"],
["to judge", "judge"],
["the living and the dead.", "living", "dead"],
["I believe in the Holy Spirit", "Spirit", "believe"],
["the holy catholic church", "church", "holy"],
["the communion of saints", "communion", "saints"],
["the forgiveness of sins", "forgiveness", "sins"],
["the resurrection of the body", "resurrection", "body"],
["and the life everlasting.", "life", "everlasting"]
];

const slideColors = [
"#7f66c6", // 1 - purple
"#ffc751", // 2 - yellow
"#333333", // 3 - gray
"#ffa351", // 4 - orange
"#a7cb6f", // 5 - green
"#ff5a51", // 6 - red
"#ffc751", // 7 - yellow
"#40b9c5", // 8 - blue
"#ff5a51", // 9 - red
"#f2f2f2", // 10 - white
"#333333", // 11 - gray
"#ffa351", // 12 - orange
"#a7cb6f", // 13 - green
"#40b9c5", // 14 - blue
"#ffc751", // 15 - yellow
"#7f66c6", // 16 - purple
"#40b9c5", // 17 - blue
"#ffa351", // 18 - orange
"#7f66c6", // 19 - purple
"#ffc751", // 20 - yellow
"#f2f2f2", // 21 - white
"#a7cb6f", // 22 - green
"#ff5a51", // 23 - red
"#a7cb6f", // 24 - green
"#7f66c6"  // 25 - purple
];

let screen="intro";
let index=0;
let muted=false;
let testMode=null;
let hintState=0;

// --- Inline SVG icons (from your uploaded SVGs) ---
const SVG_BACK = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path style="fill:#ffffff;stroke-width:74.9031;stroke-linecap:round"
    d="M 90.101697,426.07323 665.52324,88.164306 a 20.830539,20.830539 29.78848 0 1 31.37872,17.962384 v 676.74658 a 20.830539,20.830539 150.21152 0 1 -31.37872,17.96238 L 90.101697,462.92673 a 21.369052,21.369052 90 0 1 0,-36.8535 z"
    transform="translate(246.77226)" />
</svg>`;

const SVG_FORWARD = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path style="fill:#ffffff;stroke-width:74.9031;stroke-linecap:round"
    d="M 90.101697,426.07323 665.52324,88.164306 a 20.830539,20.830539 29.78848 0 1 31.37872,17.962384 v 676.74658 a 20.830539,20.830539 150.21152 0 1 -31.37872,17.96238 L 90.101697,462.92673 a 21.369052,21.369052 90 0 1 0,-36.8535 z"
    transform="matrix(-1,0,0,1,1023.2277,0)" />
</svg>`;

const SVG_MUTE = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path style="fill:#ffffff;stroke:none;stroke-width:44.9431;stroke-linecap:round"
    d="M 660.98465,87.244161 409.97079,241.6972 a 150.47802,150.47802 0 0 1 -78.85883,22.31829 H 225.63234 a 42.587633,42.587633 0 0 0 -42.58762,42.58762 v 275.79372 a 42.587633,42.587633 0 0 0 42.58762,42.58762 h 105.47962 a 150.47802,150.47802 0 0 1 78.85883,22.3183 l 251.01386,154.45304 a 23.799138,23.799138 0 0 0 36.27121,-20.26933 V 107.51349 A 23.799138,23.799138 0 0 0 660.98465,87.244161 Z" />
  <g transform="translate(-26.458334,-255.59263)">
    <path style="fill:none;stroke:#ffffff;stroke-width:76.7747;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="M 1241.4124,524.69155 890.61025,875.49365" />
    <path style="fill:none;stroke:#ffffff;stroke-width:76.7747;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="m 890.61025,524.69155 350.80215,350.8021" />
  </g>
</svg>`;

const SVG_UNMUTE = `
<svg class="nav-icon" viewBox="0 0 1270 889" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <g transform="matrix(2.9017243,0,0,2.9017243,-948.59169,1423.6267)">
    <path style="fill:#ffffff;stroke:none;stroke-width:15.4884;stroke-linecap:round"
      d="m 554.69651,-460.54773 -86.50507,53.22802 a 51.858137,51.858137 0 0 1 -27.17654,7.69139 h -36.35067 a 14.676664,14.676664 0 0 0 -14.67666,14.67666 v 95.04477 a 14.676664,14.676664 0 0 0 14.67666,14.67666 h 36.35067 a 51.858137,51.858137 0 0 1 27.17654,7.69139 l 86.50507,53.22802 a 8.2017227,8.2017227 0 0 0 12.49988,-6.98527 v -232.26637 a 8.2017227,8.2017227 0 0 0 -12.49988,-6.98527 z" />
    <path style="fill:none;stroke:#ffffff;stroke-width:26.4583;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="m 596.38634,-270.01659 c 26.00162,-13.81364 42.0863,-39.52797 42.16745,-67.41243 -0.0102,-27.95044 -16.10446,-53.75052 -42.16745,-67.5969" />
    <path style="fill:none;stroke:#ffffff;stroke-width:26.4583;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1"
      d="m 626.65943,-233.57231 c 4.34269,-2.51562 16.69789,-10.99898 23.86366,-17.76894 23.32002,-22.03191 37.74343,-52.46821 37.74343,-86.08777 0,-33.61956 -14.42341,-64.05637 -37.74343,-86.08828 -7.16577,-6.76996 -19.52097,-15.25332 -23.86366,-17.76894" />
  </g>
</svg>`;


// Reuse one audio player (important for iPhone autoplay behavior)
const audioPlayer = new Audio();
audioPlayer.preload = "auto";

// After we "unlock" once, later plays are more reliable
let audioUnlocked = false;

/* ---------- Utility ---------- */

function getColor(i){
    return slideColors[i];
}

function playAudio(i){
    if (muted) return;

    audioPlayer.pause();
    audioPlayer.currentTime = 0;
    audioPlayer.src = `creed_audio/creed_${String(i+1).padStart(2,"0")}.mp3`;
    audioPlayer.volume = 1;

    audioPlayer.play().catch(()=>{});
}

function unlockAudioForIOS() {
    if (audioUnlocked) return;

    // Use slide 1 as the unlock source (must exist)
    audioPlayer.src = `creed_audio/creed_01.mp3`;
    audioPlayer.volume = 0;

    // Try to start playback during the user's tap
    const p = audioPlayer.play();
    if (p && typeof p.then === "function") {
        p.then(() => {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.volume = 1;
            audioUnlocked = true;
        }).catch(() => {
            // If it fails, we'll still be fine on later user-gesture plays
        });
    }
}


function maskWord(word, revealLetters=0){
    return word.split("").map((c,i)=>{
        if(c===" ") return " ";
        if(i<revealLetters) return word[i];
        return "_";
    }).join("");
}

function maskPhrase(phrase, removeWords, reveal=0){
    let result=phrase;
    removeWords.forEach(w=>{
        const masked = reveal===2 ? w :
                       reveal===1 ? maskWord(w,1) :
                       maskWord(w,0);
        result = result.replace(new RegExp(w,"i"), masked);
    });
    return result;
}

function computeTestDisplayPhrase() {
    const phraseData = phrases[index];
    const phrase = phraseData[0];

    let remove = [];
    if (testMode === "easy") remove = [phraseData[1]];
    if (testMode === "medium") remove = phraseData.slice(1);

    if (testMode === "hard" && hintState === 0) return "";
    if (testMode === "hard" && hintState === 1) return maskPhrase(phrase, phraseData.slice(1), 0);
    if (testMode === "hard" && hintState === 2) return phrase;

    return maskPhrase(phrase, remove, hintState);
}

function updateTestHintUI() {
    const phraseEl = document.getElementById("testPhrase");
    if (phraseEl) phraseEl.textContent = computeTestDisplayPhrase();

    const hintBtn = document.getElementById("hintBtn");
    if (hintBtn) hintBtn.textContent = (hintState === 0) ? "Hint" : "Reveal";
}

/* ---------- Slide Engine ---------- */

function showSlide(contentHTML, bgColor, direction = "forward") {
    const app = document.getElementById("app");

    // Remove any non-slide screens (like title/mode screens), but keep the current slide for animation
    [...app.children].forEach(child => {
        if (!child.classList || !child.classList.contains("slide")) child.remove();
    });

    const oldSlide = app.querySelector(".slide");

    const newSlide = document.createElement("div");
    newSlide.className = "slide";
    newSlide.style.background = bgColor;
    newSlide.innerHTML = contentHTML;

    // Starting positions based on direction
    if (direction === "back") {
        newSlide.style.transform = "translateX(-100%)";
    } else if (direction === "none") {
        newSlide.style.transform = "translateX(0)";
    } else {
        newSlide.style.transform = "translateX(100%)";
    }

    app.appendChild(newSlide);

    // If no animation requested, just remove old and finish
    if (direction === "none") {
        if (oldSlide) oldSlide.remove();
        return;
    }

    requestAnimationFrame(() => {
        newSlide.style.transition = "transform .4s ease";
        newSlide.style.transform = "translateX(0)";

        if (oldSlide) {
            oldSlide.style.transition = "transform .4s ease";
            oldSlide.style.transform = (direction === "back")
                ? "translateX(100%)"
                : "translateX(-100%)";
            setTimeout(() => oldSlide.remove(), 400);
        }
    });
}

/* ---------- Screens ---------- */

function introScreen(){
    const html=`
    <div class="intro">
        <img id="introImg" src="creed_images/intro_bible.png">
    </div>`;
    document.getElementById("app").innerHTML=html;

    const img=document.getElementById("introImg");
    img.onclick=()=>{
        img.src="creed_images/intro_bible_bite.png";
        new Audio("creed_audio/chomp.mp3").play();
        setTimeout(()=>titleScreen(),600);
    };
}

function titleScreen(){
    screen="title";
    const html=`
    <div class="title-screen">
        <div class="title-content" id="titleContent">
            <img src="creed_images/creed_title.png">
            <h2>Let's learn the Apostle's Creed</h2>
            <div class="title-buttons">
                <button class="learn-btn" onclick="startLearn()">Learn the Verse</button>
                <button class="test-btn" onclick="modeSelect()">Test Yourself</button>
            </div>
        </div>
        <div class="footer">
            More free Bible resources at:<br>
            <a href="https://www.eatyourbible.com" target="_blank" style="color:white;">
            www.eatyourbible.com</a>
        </div>
    </div>`;
    document.getElementById("app").innerHTML=html;
}

function startLearn(){
    unlockAudioForIOS();   // <--- add this line
    screen="learn";
    index=0;
    showLearnIntro();
}


function showLearnIntro(){
    showSlide(`
    <div class="content">
        <div class="text-area">
            <div>
                <div class="large-text">Let's Read the Apostles Creed.</div>
                <div class="small-text">Use the arrows to go forward and back.</div>
            </div>
        </div>
        <div class="nav"></div>
    </div>`, "#7f66c6");
    setTimeout(()=>nextLearn(),3500);
}

function nextLearn(direction = "forward"){
    if(index>=phrases.length){
        showLearnEnd();
        return;
    }
    const phrase=phrases[index][0];
    const color=getColor(index);
    const html=`
    <div class="content">
        <div class="image-area">
            <img src="creed_images/creed_${String(index+1).padStart(2,"0")}.png">
        </div>
        <div class="text-area">
            <div class="phrase">${phrase}</div>
        </div>
    </div>
    <div class="nav">
        <button onclick="prevLearn()" aria-label="Back">${SVG_BACK}</button>
        <button class="center-btn" id="muteBtn" onclick="toggleMute()" aria-label="Mute toggle">
            ${muted ? SVG_MUTE : SVG_UNMUTE}
        </button>
        <button onclick="forwardLearn()" aria-label="Forward">${SVG_FORWARD}</button>
    </div>`;
    showSlide(html, color, direction);
    playAudio(index);
}

function forwardLearn(){
    index++;
    nextLearn("forward");
}

function prevLearn(){
    if(index>0){
        index--;
        nextLearn("back");
    }
}



function toggleMute(){
    muted = !muted;
    const btn = document.getElementById("muteBtn");
    if (btn) btn.innerHTML = muted ? SVG_MUTE : SVG_UNMUTE;
}

function showLearnEnd(){
    const html=`
    <div class="content">
        <div class="image-area">
            <img src="creed_images/creed_end.png">
        </div>
        <div class="text-area">
            <div>
                <div class="phrase">Great job!</div>
                <br>
                <button onclick="titleScreen()">Title Screen</button>
                <button onclick="modeSelect()">Test Yourself</button>
            </div>
        </div>
    </div>
    <div class="nav">
        <button onclick="titleScreen()">⬅️</button>
        <div></div>
        <div></div>
    </div>`;
    showSlide(html,"#40b9c5");
}

/* ---------- Test Mode ---------- */

function modeSelect(){
    screen="mode";
    const html=`
    <div class="mode-screen">
        <div class="mode-section easy" onclick="startTest('easy')">
            <h2>Easy</h2>
            <p>Try to guess the missing word</p>
        </div>
        <div class="mode-section medium" onclick="startTest('medium')">
            <h2>Medium</h2>
            <p>More words go missing.</p>
        </div>
        <div class="mode-section hard" onclick="startTest('hard')">
            <h2>Hard</h2>
            <p>Try to say it using the images only.</p>
        </div>
    </div>`;
    document.getElementById("app").innerHTML=html;
}

function startTest(mode){
    screen="test";
    testMode=mode;
    index=0;
    hintState=0;
    nextTest();
}

function nextTest(){
    if(index>=phrases.length){
        showTestEnd();
        return;
    }
    hintState=0;
    renderTest();
}

function renderTest(direction = "forward"){
    const phraseData=phrases[index];
    const phrase=phraseData[0];
    let remove=[];
    if(testMode==="easy") remove=[phraseData[1]];
    if(testMode==="medium") remove=phraseData.slice(1);
    let displayPhrase=phrase;

    if(testMode==="hard" && hintState===0){
        displayPhrase="";
    } else if(testMode==="hard" && hintState===1){
        displayPhrase=maskPhrase(phrase,phraseData.slice(1),0);
    } else if(testMode==="hard" && hintState===2){
        displayPhrase=phrase;
    } else {
        displayPhrase=maskPhrase(phrase,remove,hintState);
    }

    const color=getColor(index);
    const html=`
    <div class="content">
        <div class="image-area">
            <img src="creed_images/creed_${String(index+1).padStart(2,"0")}.png">
        </div>
        <div class="text-area">
            <div class="phrase" id="testPhrase">${displayPhrase}</div>
        </div>
    </div>
    <div class="nav">
        <button onclick="prevTest()" aria-label="Back">${SVG_BACK}</button>
        <button class="center-btn" id="hintBtn" onclick="hint()">${hintState===0?"Hint":"Reveal"}</button>
        <button onclick="forwardTest()" aria-label="Forward">${SVG_FORWARD}</button>
    </div>`;
showSlide(html, color, direction);
}

function hint(){
    if (hintState < 2) hintState++;
    updateTestHintUI(); // no animation
}

function forwardTest(){
    index++;
    renderTest("forward");
}

function prevTest(){
    if(index > 0){
        index--;
        renderTest("back");
    }
}

function showTestEnd(){
    const html=`
    <div class="content">
        <div class="image-area">
            <img src="creed_images/end_screen.png">
        </div>
        <div class="text-area">
            <div>
                <div class="phrase">Great job!</div>
                <br>
                <button onclick="modeSelect()">Change Mode</button>
                <button onclick="titleScreen()">Title Screen</button>
            </div>
        </div>
    </div>
    <div class="nav">
        <button onclick="modeSelect()">⬅️</button>
        <div></div>
        <div></div>
    </div>`;
    showSlide(html,"#7f66c6");
}



/* ---------- Start ---------- */

introScreen();
</script>
</body>
</html>
