<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Devotional Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-gradient-top: #eef3ff;
      --bg-gradient-bottom: #d8e8ff;
      --card-bg: #ffffff;
      --accent: #3f6df6;
      --accent-dark: #2743a5;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --question-bg: #111827;
      --button-radius: 0.9rem;

      /* color buttons */
      --red: #ff5a51;
      --yellow: #ffc751;
      --blue: #40b9c5;
      --green: #a7cb6f;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    html,
    body {
      height: 100%;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      background: radial-gradient(circle at top, var(--bg-gradient-top), var(--bg-gradient-bottom));
      background-size: 150% 150%;
      animation: bgDrift 22s ease-in-out infinite alternate;
      color: var(--text-main);
      overflow: hidden; /* good for TVs */
    }

    @keyframes bgDrift {
      0% {
        background-position: 0% 0%;
      }
      100% {
        background-position: 100% 100%;
      }
    }

    #app {
      width: 100%;
      height: 100vh;
      max-width: none;
      padding: 0;
      display: flex;
      align-items: stretch;
      justify-content: stretch;
    }

    .screen-card {
      background: var(--card-bg);
      border-radius: 0;
      box-shadow: 0 0 40px rgba(15, 23, 42, 0.18);
      padding: 18px 14px 22px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      min-height: 100vh;
      width: 100%;
      max-width: 100%;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .screen-card {
        padding: 26px 32px 30px;
      }
    }

.hidden {
      display: none !important;
    }


.card-header {
      text-align: center;
      margin-bottom: 18px;
    }

/* Vertically center the whole title block on the title screen */
#title-screen {
      display: flex;
      flex-direction: column;
      justify-content: center; /* centers everything vertically */
      align-items: center;     /* centers horizontally */
}

#title-screen .title-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 40px; /* space above the start button */
}


/* Keep the header itself centered horizontally */
#title-screen .card-header {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 0;   /* no manual push-down anymore */
}


#end-screen {
      justify-content: center;  /* vertically center header + score block */
}



.title-layout {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 18px;
}



.title-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }



.lesson-image-wrapper {
      width: 140px;
      height: 140px;
      margin: 0;
      border-radius: 0;
      overflow: visible;
      background: transparent;   /* no grey rectangle */
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: none;          /* no shadow box */
    }


    @media (min-width: 1024px) {
      .lesson-image-wrapper {
        width: 200px;
        height: 200px;
      }
    }

    .lesson-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transform-origin: top center;
      animation: float 4.5s ease-in-out infinite;
    }

    .bounce-drop {
      animation: dropBounce 0.9s ease-out;
    }

    @keyframes dropBounce {
      0% {
        transform: translateY(-150%) scale(0.8);
      }
      60% {
        transform: translateY(8%) scale(1.06);
      }
      100% {
        transform: translateY(0) scale(1);
      }
    }

    @keyframes float {
      0% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(6px);
      }
      100% {
        transform: translateY(0);
      }
    }

    .card-title {
      font-size: clamp(1.8rem, 4vw, 2.6rem);
      font-weight: 800;
      letter-spacing: 0.02em;
      margin-bottom: 6px;
    }

    .card-subtitle {
      font-size: clamp(1rem, 2vw, 1.25rem);
      color: var(--text-muted);
    }

    .center-row {
   margin-top: 24px;  /* small gap under the title */
   display: flex;
   justify-content: center;
  }


    .primary-button,
    .secondary-button {
      border-radius: 999px;
      border: none;
      padding: 12px 22px;
      font-size: clamp(1rem, 1.8vw, 1.25rem);
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.35);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .primary-button {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: #ffffff;
      animation: pulse 2.4s ease-in-out infinite;
    }

    .secondary-button {
      background: #f3f4ff;
      color: var(--accent-dark);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
    }

    .primary-button:hover,
    .secondary-button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.35);
    }

    .primary-button:active,
    .secondary-button:active {
      transform: translateY(0);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.25);
      filter: brightness(0.96);
    }

    @keyframes pulse {
      0%,
      100% {
        transform: scale(1);
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.35);
      }
      50% {
        transform: scale(1.03);
        box-shadow: 0 18px 40px rgba(37, 99, 235, 0.5);
      }
    }

    /* Top bar & progress */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(0.95rem, 1.8vw, 1.15rem);
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .sound-toggle {
      border-radius: 999px;
      border: none;
      background: #edf2ff;
      padding: 6px 9px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 3px 9px rgba(15, 23, 42, 0.2);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    .sound-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.25);
      filter: brightness(1.06);
    }

    .sound-toggle:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.2);
      filter: brightness(0.96);
    }

    .progress-track {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background-image: linear-gradient(
        120deg,
        #3f6df6,
        #22c55e,
        #3f6df6
      );
      background-size: 200% 100%;
      animation: progressFlow 2.5s linear infinite;
      transition: width 0.25s ease;
    }

    @keyframes progressFlow {
      0% {
        background-position: 0% 0%;
      }
      100% {
        background-position: 100% 0%;
      }
    }

    /* QUIZ LAYOUT */
    .quiz-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    /* top 50%: question */
    .question-panel {
      flex: 1 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 0;
    }

    .question-card {
      width: 100%;
      height: 100%;
      background: var(--question-bg);
      color: #ffffff;
      border-radius: 1.35rem;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: 0 12px 38px rgba(15, 23, 42, 0.55);
    }

    .question-card.question-in {
      animation: questionSlideIn 0.35s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    }

    @keyframes questionSlideIn {
      0% {
        transform: translateY(-18px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .question-card.shake {
      animation: shake 0.35s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
    }

    .question-text {
      font-size: clamp(1.4rem, 3.2vw, 3rem);
      font-weight: 600;
      line-height: 1.3;
    }

    /* bottom 50%: answers */
    .answers-panel {
      flex: 1 0 0;
      display: flex;
      flex-direction: column;
      padding-top: 10px;
      min-height: 0;
    }

    .answers-grid {
      flex: 1 1 0;
      display: grid;
      grid-template-columns: 1fr;
      grid-auto-rows: 1fr;
      gap: 12px;
      align-content: stretch;
    }

    .answers-grid.answers-in {
      animation: answersPopIn 0.3s ease-out;
    }

    @keyframes answersPopIn {
      0% {
        transform: translateY(18px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @media (min-width: 640px) {
      .answers-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .answer-button {
      width: 100%;
      height: 100%;
      padding: 16px 18px;
      border-radius: var(--button-radius);
      border: 3px solid rgba(255, 255, 255, 0.8);
      cursor: pointer;
      font-size: clamp(1.4rem, 3vw, 3rem);
      font-weight: 600;
      text-align: center;
      justify-content: center;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.3);
      transition:
        transform 0.08s ease,
        box-shadow 0.08s ease,
        filter 0.08s ease,
        border-color 0.08s ease;
    }

    .answer-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(15, 23, 42, 0.4);
      filter: brightness(1.05);
      border-color: rgba(255, 255, 255, 1);
    }

    .answer-button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.3);
      filter: brightness(0.97);
    }

    .answer-text {
      flex: 1;
      line-height: 1.35;
    }

    .answer-button.disabled {
      pointer-events: none;
      opacity: 0.85;
      filter: none;
    }

    /* color backgrounds */
    .color-red {
      background: var(--red);
      color: #ffffff;
    }

    .color-yellow {
      background: var(--yellow);
      color: #333333;
    }

    .color-blue {
      background: var(--blue);
      color: #ffffff;
    }

    .color-green {
      background: var(--green);
      color: #ffffff;
    }

    .score-row {
      display: flex;
      justify-content: space-between;
      font-size: clamp(0.95rem, 1.6vw, 1.2rem);
      padding-top: 10px;
      margin-top: 4px;
      border-top: 1px solid #e5e7eb;
      color: var(--text-muted);
    }

    .score-row strong {
      color: var(--text-main);
    }

    /* feedback overlay */
    #feedback-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      pointer-events: none;
    }

    #feedback-overlay.visible {
      display: flex;
    }

    .feedback-inner {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 999px;
      padding: 18px 24px;
      text-align: center;
      color: #ffffff;
      max-width: 90%;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.8);
    }

    .feedback-title {
      font-size: clamp(2rem, 3.5vw, 3.2rem);
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .feedback-title.correct-text {
      color: #bbf7d0;
    }

    .feedback-title.incorrect-text {
      color: #fecaca;
    }

    .feedback-detail {
      font-size: clamp(1rem, 1.8vw, 1.3rem);
      margin-top: 4px;
    }

    .star {
      position: fixed;
      top: -40px;
      font-size: clamp(1.6rem, 2.6vw, 2.2rem);
      animation: fall 1.2s linear forwards;
      z-index: 60;
      pointer-events: none;
    }

    @keyframes fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(110vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* quick flash on correct */
    .screen-flash {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.7);
      animation: flash 0.25s ease-out forwards;
      pointer-events: none;
      z-index: 40;
    }

    @keyframes flash {
      0% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
      }
    }

    /* end screen */
    .end-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      text-align: center;
    }

    .end-score {
      font-size: clamp(2.2rem, 3.3vw, 3rem);
      font-weight: 800;
      color: var(--accent-dark);
    }

    .end-detail {
      font-size: clamp(1.05rem, 1.8vw, 1.3rem);
      color: var(--text-muted);
    }

    .end-trophy {
      font-size: clamp(3rem, 6vw, 4rem);
    }

    .end-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 12px;
    }

    #end-screen.end-great {
      background: radial-gradient(circle at top, #fef9c3, #bbf7d0);
    }

    #end-screen.end-good {
      background: radial-gradient(circle at top, #dbeafe, #cffafe);
    }

    #end-screen.end-try {
      background: radial-gradient(circle at top, #fee2e2, #fef3c7);
    }

    /* fullscreen scaling */
    :fullscreen .question-text,
    :-webkit-full-screen .question-text {
      font-size: clamp(2.4rem, 4vw, 5rem);
    }

    :fullscreen .answer-button,
    :-webkit-full-screen .answer-button {
      font-size: clamp(2rem, 3.5vw, 4rem);
    }

    :fullscreen .card-title,
    :-webkit-full-screen .card-title {
      font-size: clamp(2.4rem, 4.2vw, 3.2rem);
    }

/* ---- Mobile tweaks: make sure all four answer buttons fit ---- */
@media (max-width: 600px) {
  /* allow vertical scrolling on phones if needed */
  body {
    overflow-y: auto;
  }

  /* tighten spacing a bit */
  .quiz-main {
    margin-top: 4px;
    gap: 6px;
  }

  /* give LESS space to the question, MORE to the answers */
  .question-panel {
    flex: 0.7 0 auto;   /* was 1 */
  }

  .answers-panel {
    flex: 1.3 0 auto;   /* was 1 */
  }

  /* make the question card a little more compact */
  .question-card {
    padding: 10px 12px;
  }

  .question-text {
    font-size: 1.1rem;  /* override the big clamp() on phones */
    line-height: 1.25;
  }

  /* make the answer buttons slightly smaller and tighter */
  .answers-grid {
    gap: 8px;
  }

  .answer-button {
    font-size: 1rem;    /* smaller than the desktop clamp() */
    padding: 10px 12px;
  }
}


  </style>
</head>
<body>
  <div id="app">
    <!-- TITLE SCREEN -->
<div id="title-screen" class="screen-card">
      <!-- New wrapper that we will vertically center -->
      <div class="title-content">
        <div class="card-header">
          <div class="title-layout">
            <div class="lesson-image-wrapper">
              <img
                id="lesson-image"
                class="lesson-image bounce-drop"
                src="quizimages/ot01image.png"
                alt="Lesson image"
              />
            </div>
            <div class="title-text">
              <h1 id="lesson-title" class="card-title">Sample Devotional Quiz</h1>
              <p id="lesson-subtitle" class="card-subtitle">
                10 questions to review today&rsquo;s Bible story
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="center-row">

        <button id="start-quiz-btn" class="primary-button">
          <span>Go fullscreen &amp; start</span> <span>‚ñ∂</span>
        </button>
      </div>
    </div>


    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="screen-card hidden">
      <div class="top-bar">
        <span>Question <strong id="question-number">1</strong> of <strong id="total-questions">10</strong></span>
        <button id="sound-toggle" class="sound-toggle" aria-label="Toggle sound">üîä</button>
      </div>
      <div class="progress-track">
        <div id="progress-fill" class="progress-fill"></div>
      </div>

      <div class="quiz-main">
        <!-- top 50%: question card -->
        <div class="question-panel">
          <div class="question-card" id="question-card">
            <div class="question-text" id="question-text">
              Question text will go here
            </div>
          </div>
        </div>

        <!-- bottom 50%: answers + score -->
        <div class="answers-panel">
          <div class="answers-grid" id="answers-grid">
            <button class="answer-button color-red" data-button-index="0">
              <span class="answer-text"></span>
            </button>
            <button class="answer-button color-yellow" data-button-index="1">
              <span class="answer-text"></span>
            </button>
            <button class="answer-button color-blue" data-button-index="2">
              <span class="answer-text"></span>
            </button>
            <button class="answer-button color-green" data-button-index="3">
              <span class="answer-text"></span>
            </button>
          </div>

          <div class="score-row">
            <span>Score: <strong id="score-display">0</strong></span>
            <span>Streak: <strong id="streak-display">x0</strong></span>
          </div>
        </div>
      </div>
    </div>

    <!-- END SCREEN -->
    <div id="end-screen" class="screen-card hidden">
      <div class="card-header">
        <div class="end-trophy" id="end-trophy">üèÜ</div>
        <h2 class="card-title" id="end-title">Quiz Complete!</h2>
        <p class="card-subtitle" id="end-subtitle">Here&rsquo;s how you did</p>
      </div>
      <div class="end-main">
        <div class="end-score" id="final-score">0 points</div>
        <div class="end-detail" id="final-correct">
          You got 0 out of 10 correct
        </div>
        <div class="end-buttons">
          <button id="play-again-btn" class="primary-button">Play Again</button>
          <button id="back-to-title-btn" class="secondary-button">Back to Title</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FEEDBACK OVERLAY -->
  <div id="feedback-overlay">
    <div class="feedback-inner">
      <div id="feedback-title" class="feedback-title">CORRECT</div>
      <div id="feedback-detail" class="feedback-detail"></div>
    </div>
  </div>

  <script>
    // =======================
    // QUESTION DATA
    // =======================
    const QUESTIONS = [
      {
        text: "What did God create on day one?",
        answers: [
          "The heavens and the earth and light",
          "The sky and the sea",
          "Dry land and plants",
          "Sun, moon, and stars"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day two?",
        answers: [
          "He separated the sky and the sea",
          "Dry land and plants",
          "Birds and fish",
          "Land animals and human beings"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day three?",
        answers: [
          "Dry land and plants",
          "The sky and the sea",
          "Sun, moon, and stars",
          "Birds and fish"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day four?",
        answers: [
          "Sun, moon, and stars",
          "Dry land and plants",
          "Land animals and people",
          "Birds and fish"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day five?",
        answers: [
          "Birds and fish",
          "The sky and the sea",
          "Land animals and people",
          "Sun, moon, and stars"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day six?",
        answers: [
          "Land animals and human beings",
          "Birds and fish",
          "Dry land and plants",
          "Nothing, He rested"
        ],
        correctIndex: 0
      },
      {
        text: "How are human beings different than everything else God made?",
        answers: [
          "We\u2019re made in His likeness and given the job to rule over His creation",
          "We can swim and fly better than all animals",
          "We were created before light and water",
          "We live under the sea like fish"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day seven?",
        answers: [
          "Nothing, He rested",
          "Birds and fish",
          "The sky and the sea",
          "Sun, moon, and stars"
        ],
        correctIndex: 0
      },
      {
        text: "How did God create everything?",
        answers: [
          "Out of nothing, just by speaking",
          "By using tools and machines",
          "By asking the angels to build it",
          "By finding pieces that were already there"
        ],
        correctIndex: 0
      },
      {
        text: "What did God say after seeing everything He made?",
        answers: [
          "It was very good",
          "It was almost good enough",
          "It needed to be fixed later",
          "He wasn\u2019t sure He liked it"
        ],
        correctIndex: 0
      }
    ];

    // =======================
    // DOM REFERENCES
    // =======================
    const titleScreen = document.getElementById("title-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const endScreen = document.getElementById("end-screen");

    const startBtn = document.getElementById("start-quiz-btn");
    const playAgainBtn = document.getElementById("play-again-btn");
    const backToTitleBtn = document.getElementById("back-to-title-btn");

    const questionNumberEl = document.getElementById("question-number");
    const totalQuestionsEl = document.getElementById("total-questions");
    const progressFillEl = document.getElementById("progress-fill");

    const questionCardEl = document.getElementById("question-card");
    const questionTextEl = document.getElementById("question-text");
    const answersGridEl = document.getElementById("answers-grid");
    const answerButtons = Array.from(
      document.querySelectorAll(".answer-button")
    );

    const scoreDisplayEl = document.getElementById("score-display");
    const streakDisplayEl = document.getElementById("streak-display");

    const feedbackOverlay = document.getElementById("feedback-overlay");
    const feedbackTitleEl = document.getElementById("feedback-title");
    const feedbackDetailEl = document.getElementById("feedback-detail");

    const soundToggleBtn = document.getElementById("sound-toggle");

    const finalScoreEl = document.getElementById("final-score");
    const finalCorrectEl = document.getElementById("final-correct");
    const endTitleEl = document.getElementById("end-title");
    const endSubtitleEl = document.getElementById("end-subtitle");
    const endTrophyEl = document.getElementById("end-trophy");

    totalQuestionsEl.textContent = QUESTIONS.length.toString();

    // =======================
    // STATE
    // =======================
    let currentQuestionIndex = 0;
    let score = 0;
    let streak = 0;
    let correctCount = 0;
    let soundEnabled = true;
    let currentAnswerOrder = [];
    let isLocked = false;

    // Web Audio setup
    let audioCtx = null;

    function getAudioContext() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC) {
          audioCtx = new AC();
        }
      }
      return audioCtx;
    }

    function playBeepSequence(notes) {
      if (!soundEnabled) return;
      const ctx = getAudioContext();
      if (!ctx) return;
      const now = ctx.currentTime;
      notes.forEach((note, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.type = "triangle";
        osc.frequency.value = note.freq;
        const t0 = now + i * note.duration;
        const t1 = t0 + note.duration;
        gain.gain.setValueAtTime(0, t0);
        gain.gain.linearRampToValueAtTime(0.45, t0 + 0.02);
        gain.gain.linearRampToValueAtTime(0.0, t1);
        osc.start(t0);
        osc.stop(t1 + 0.02);
      });
    }

    function playCorrectSound() {
      playBeepSequence([
        { freq: 660, duration: 0.12 },
        { freq: 880, duration: 0.12 },
        { freq: 1040, duration: 0.14 }
      ]);
    }

    function playIncorrectSound() {
      playBeepSequence([
        { freq: 260, duration: 0.16 },
        { freq: 200, duration: 0.18 }
      ]);
    }

    // =======================
    // HELPERS
    // =======================
    function shuffleArray(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function showScreen(screen) {
      titleScreen.classList.add("hidden");
      quizScreen.classList.add("hidden");
      endScreen.classList.add("hidden");
      screen.classList.remove("hidden");
    }

    function spawnStarRain(count) {
      for (let i = 0; i < count; i++) {
        const star = document.createElement("div");
        star.className = "star";
        star.textContent = "‚≠ê";
        const left = Math.random() * 100;
        const delay = Math.random() * 0.6;
        star.style.left = left + "vw";
        star.style.animationDelay = delay + "s";
        document.body.appendChild(star);
        star.addEventListener("animationend", () => {
          star.remove();
        });
      }
    }

    function flashScreen() {
      const flash = document.createElement("div");
      flash.className = "screen-flash";
      document.body.appendChild(flash);
      flash.addEventListener("animationend", () => flash.remove());
    }

    function showFeedback(isCorrect, detailText) {
      feedbackTitleEl.textContent = isCorrect ? "CORRECT" : "INCORRECT";
      feedbackTitleEl.classList.toggle("correct-text", isCorrect);
      feedbackTitleEl.classList.toggle("incorrect-text", !isCorrect);
      feedbackDetailEl.textContent = detailText || "";
      feedbackOverlay.classList.add("visible");
      setTimeout(() => feedbackOverlay.classList.remove("visible"), 800);
    }

    function updateScoreDisplays() {
      scoreDisplayEl.textContent = score.toString();
      streakDisplayEl.textContent = "x" + streak.toString();
    }

    function animateQuestionIn() {
      questionCardEl.classList.remove("question-in", "shake");
      answersGridEl.classList.remove("answers-in");
      // force reflow so animation can replay
      void questionCardEl.offsetWidth;
      questionCardEl.classList.add("question-in");
      answersGridEl.classList.add("answers-in");
    }

    // =======================
    // GAME LOGIC
    // =======================
    function startGame() {
      currentQuestionIndex = 0;
      score = 0;
      streak = 0;
      correctCount = 0;
      updateScoreDisplays();
      showScreen(quizScreen);
      loadQuestion();
    }

    function loadQuestion() {
      if (currentQuestionIndex >= QUESTIONS.length) {
        endGame();
        return;
      }

      const q = QUESTIONS[currentQuestionIndex];
      questionNumberEl.textContent = (currentQuestionIndex + 1).toString();
      questionTextEl.textContent = q.text;

      const progress =
        ((currentQuestionIndex) / QUESTIONS.length) * 100;
      progressFillEl.style.width = progress + "%";

      // enable buttons
      isLocked = false;
      answerButtons.forEach((btn) => {
        btn.classList.remove("disabled");
      });

      // shuffle answer mapping
      const indices = [0, 1, 2, 3];
      currentAnswerOrder = shuffleArray(indices);

      answerButtons.forEach((btn, i) => {
        const answerIndex = currentAnswerOrder[i];
        const span = btn.querySelector(".answer-text");
        span.textContent = q.answers[answerIndex];
        btn.dataset.answerIndex = String(answerIndex);
      });

      animateQuestionIn();
    }

    function handleAnswerClick(event) {
      if (isLocked) return;
      const btn = event.currentTarget;
      const answerIndex = Number(btn.dataset.answerIndex);
      const q = QUESTIONS[currentQuestionIndex];

      isLocked = true;
      answerButtons.forEach((b) => b.classList.add("disabled"));

      const isCorrect = answerIndex === q.correctIndex;

      if (isCorrect) {
        streak += 1;
        const earned = 100 * streak;
        score += earned;
        correctCount += 1;
        updateScoreDisplays();
        playCorrectSound();
        flashScreen();
        spawnStarRain(24);
        showFeedback(
          true,
          `Streak bonus: ${streak} in a row! +${earned} points`
        );
      } else {
        playIncorrectSound();
        const correctText = q.answers[q.correctIndex];
        showFeedback(false, `Correct answer: ${correctText}`);
        questionCardEl.classList.add("shake");
        streak = 0;
        updateScoreDisplays();
      }

      // progress to next question after short delay
      setTimeout(() => {
        currentQuestionIndex += 1;
        loadQuestion();
      }, 1100);
    }

    function endGame() {
      showScreen(endScreen);

      // fill progress bar to full
      progressFillEl.style.width = "100%";

      finalScoreEl.textContent = `${score} points`;
      finalCorrectEl.textContent = `You got ${correctCount} out of ${QUESTIONS.length} correct`;

      const ratio = correctCount / QUESTIONS.length;
      endScreen.classList.remove("end-great", "end-good", "end-try");

      if (ratio >= 0.8) {
        endScreen.classList.add("end-great");
        endTitleEl.textContent = "Amazing Job!";
        endSubtitleEl.textContent = "You really know this story.";
        endTrophyEl.textContent = "üèÜ";
        spawnStarRain(30);
      } else if (ratio >= 0.5) {
        endScreen.classList.add("end-good");
        endTitleEl.textContent = "Nice Work!";
        endSubtitleEl.textContent = "You did well. Keep learning!";
        endTrophyEl.textContent = "üéâ";
      } else {
        endScreen.classList.add("end-try");
        endTitleEl.textContent = "Keep Practicing!";
        endSubtitleEl.textContent = "Try again and watch your score grow.";
        endTrophyEl.textContent = "‚≠ê";
      }
    }

    // =======================
    // EVENT LISTENERS
    // =======================
    startBtn.addEventListener("click", () => {
      // try to go fullscreen for TV mode
      const docEl = document.documentElement;
      if (docEl.requestFullscreen) {
        docEl.requestFullscreen().catch(() => startGame());
      } else {
        startGame();
      }
      // If fullscreen request succeeds, we'll still just start immediately.
      startGame();
    });

    playAgainBtn.addEventListener("click", () => {
      showScreen(quizScreen);
      startGame();
    });

    backToTitleBtn.addEventListener("click", () => {
      showScreen(titleScreen);
    });

    answerButtons.forEach((btn) => {
      btn.addEventListener("click", handleAnswerClick);
    });

    soundToggleBtn.addEventListener("click", () => {
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "üîä" : "üîà";
    });
  </script>
</body>
</html>
