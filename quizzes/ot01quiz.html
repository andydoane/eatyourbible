<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OT 01 Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-gradient-top: #eef3ff;
      --bg-gradient-bottom: #d8e8ff;
      --card-bg: #ffffff;
      --accent: #3f6df6;
      --accent-dark: #2743a5;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --question-bg: #111827;

      --red: #ff5a51;
      --yellow: #ffc751;
      --blue: #40b9c5;
      --green: #a7cb6f;

      --button-radius: 0.9rem;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    html, body {
      height: 100%;
    }

    body {
      min-height: 100vh;
      min-height: 100svh; /* better fullscreen-ish on mobile browsers */
      display: flex;
      justify-content: center;
      align-items: stretch;
      background: radial-gradient(circle at top, var(--bg-gradient-top), var(--bg-gradient-bottom));
      background-size: 150% 150%;
      animation: bgDrift 20s ease-in-out infinite alternate;
      color: var(--text-main);
      overflow-y: auto; /* allow scrolling on small devices if needed */
    }

    @keyframes bgDrift {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    #app {
      width: 100%;
      max-width: 1200px;
      height: 100%;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

body.mode-big #app {
  max-width: none;
  
}





    .screen-card {
      background: var(--card-bg);
      width: 100%;
      min-height: 100vh;
      min-height: 100svh;
      display: flex;
      flex-direction: column;
      padding: 18px 14px 22px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(15,23,42,0.20);
    }

    @media (min-width: 768px) {
      .screen-card {
        padding: 26px 32px 30px;
      }
    }

    .hidden {
      display: none !important;
    }

    /* ---------- INTRO SCREEN ---------- */

    #intro-screen {
      background: #000000;
      color: #ffffff;
      box-shadow: none;
      opacity: 1;
      transition: opacity 0.9s ease-out;
    }

    /* When this class is added, the intro screen fades away */
    #intro-screen.intro-fade-out {
      opacity: 0;
    }


     /* Make the whole background black during intro */
    body.intro-mode {
      background: #000000 !important;
      animation: none !important; /* stop the gradient drifting */
    }


    .intro-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 8px;
    }

    .intro-line {
      opacity: 0;
      color: #ffffff;
    }

    .intro-line-1 {
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      font-weight: 400;
      animation: introFadeIn 0.9s ease-out forwards;
      animation-delay: 0.2s;
    }

    .intro-line-2 {
      font-size: clamp(1.6rem, 4vw, 2.6rem);
      font-weight: 800;
      letter-spacing: 0.04em;
      animation: introFadeIn 0.9s ease-out forwards;
      animation-delay: 1.0s;
    }

    @keyframes introFadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }


    /* ---------- TITLE SCREEN ---------- */

    #title-screen-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 24px;
      text-align: center;
    }

    .lesson-image-wrapper {
      width: 140px;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (min-width: 900px) {
      .lesson-image-wrapper {
        width: 200px;
        height: 200px;
      }
    }

    .lesson-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      animation: float 4.5s ease-in-out infinite;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(6px); }
      100% { transform: translateY(0); }
    }

    .card-title {
      font-size: clamp(1.8rem, 4vw, 2.6rem);
      font-weight: 800;
      letter-spacing: 0.02em;
    }

    .card-subtitle {
      font-size: clamp(1rem, 2vw, 1.2rem);
      color: var(--text-muted);
    }

    .mode-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 420px;
    }

    @media (min-width: 600px) {
      .mode-buttons {
        flex-direction: row;
      }
    }

    .primary-button,
    .secondary-button {
      border-radius: 999px;
      border: none;
      padding: 12px 20px;
      font-size: clamp(1rem, 1.8vw, 1.2rem);
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .primary-button {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: #ffffff;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
    }

    .secondary-button {
      background: #f3f4ff;
      color: var(--accent-dark);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
    }

    .primary-button:hover,
    .secondary-button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.35);
    }

    .primary-button:active,
    .secondary-button:active {
      transform: translateY(0);
      filter: brightness(0.95);
      box-shadow: 0 6px 12px rgba(15, 23, 42, 0.25);
    }

    .mode-note {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 6px;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
    }

    /* ---------- TOP BAR + PROGRESS ---------- */

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(0.95rem, 1.8vw, 1.15rem);
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    .sound-toggle {
      border-radius: 999px;
      border: none;
      background: #edf2ff;
      padding: 6px 9px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 3px 9px rgba(15,23,42,0.2);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    .sound-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(15,23,42,0.25);
      filter: brightness(1.06);
    }

    .sound-toggle:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(15,23,42,0.2);
      filter: brightness(0.96);
    }

    .progress-track {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(120deg, #3f6df6, #22c55e, #3f6df6);
      background-size: 200% 100%;
      animation: progressFlow 2.5s linear infinite;
      transition: width 0.25s ease;
    }

    @keyframes progressFlow {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 0%; }
    }

    /* Timer ring (big-screen only visually) */
    .timer-ring-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    display: none; /* hidden by default (phone mode) */
    }

    body.mode-big .timer-ring-wrapper {
    display: block;
    }

    .timer-svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg); /* start at top */
    }

    /* Timer ring colors ‚Äî visible on white background */
    .timer-ring-bg {
    fill: none;
    stroke: rgba(15, 23, 42, 0.15);  /* subtle dark outline */
    stroke-width: 10;
    }

    .timer-ring-fg {
    fill: none;
    stroke: #3f6df6;                 /* bright blue ring */
    stroke-width: 10;
    stroke-linecap: round;
    stroke-dasharray: 339.292;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 0.2s linear;
    }

    .timer-text {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: #111827;                  /* dark text for visibility */
    font-weight: 700;
    }

    .timer-ring-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    display: none; /* stays big-mode only via body.mode-big */
    border-radius: 50%;
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.25);
    background: #ffffff;
    }




        /* Emoji host (right side) */
    .emoji-face {
    font-size: clamp(2.5rem, 5vw, 4rem);
    filter: drop-shadow(0 6px 12px rgba(15, 23, 42, 0.35));
    opacity: 1;
    transition: transform 0.25s ease, opacity 0.25s ease;
    }

    .emoji-face.emoji-pop {
    transform: scale(1.1);
    opacity: 1;
    }


    /* ---------- QUIZ LAYOUT (shared) ---------- */

    .quiz-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
      min-height: 0;
    }

    .question-panel {
      display: flex;
      min-height: 0;
    }

    .answers-panel {
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .question-card {
      width: 100%;
      background: var(--question-bg);
      color: #ffffff;
      border-radius: 1.35rem;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.55);
    }

    .question-text {
      font-weight: 800;
      line-height: 1.3;
    }

    .answers-grid {
      display: grid;
      gap: 12px;
      flex: 1;
      min-height: 0;
    }

    @media (min-width: 640px) {
      .answers-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .answer-button {
      width: 100%;
      border-radius: var(--button-radius);
      border: 3px solid rgba(255, 255, 255, 0.9);
      cursor: pointer;
      font-weight: 600;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(15,23,42,0.3);
      transition: transform 0.08s ease,
                  box-shadow 0.08s ease,
                  filter 0.08s ease,
                  border-color 0.08s ease;
      padding: 14px 16px;
    }

    .answer-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(15,23,42,0.4);
      filter: brightness(1.05);
      border-color: rgba(255,255,255,1);
    }

    .answer-button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15,23,42,0.3);
      filter: brightness(0.97);
    }

    .answer-button.disabled {
      pointer-events: none;
      opacity: 0.85;
      filter: none;
    }

    /* New: visual states for correct / wrong answers */
    .answer-button.answer-correct {
    box-shadow:
        0 0 0 3px rgba(255, 255, 255, 1);  /* clean white outline */
    transform: translateY(-2px) scale(1.02);
    border-color: rgba(255, 255, 255, 1); /* white border */
    }

    .answer-button.answer-wrong {
      animation: shake 0.24s ease-in-out;
      opacity: 0.9;
    }

    .answer-button.answer-faded {
      filter: grayscale(1) brightness(0.8);
      opacity: 0.5;
    }


    @keyframes shake {
      0%   { transform: translateX(0); }
      25%  { transform: translateX(-4px); }
      50%  { transform: translateX(4px); }
      75%  { transform: translateX(-4px); }
      100% { transform: translateX(0); }
    }


    .answer-text {
      line-height: 1.3;
    }

    .color-red { background: var(--red); color: #ffffff; }
    .color-yellow { background: var(--yellow); color: #222222; }
    .color-blue { background: var(--blue); color: #ffffff; }
    .color-green { background: var(--green); color: #ffffff; }

    .score-row {
      display: flex;
      justify-content: space-between;
      font-size: clamp(0.95rem, 1.6vw, 1.2rem);
      padding-top: 10px;
      margin-top: 4px;
      border-top: 1px solid #e5e7eb;
      color: var(--text-muted);
    }

    .score-row strong {
      color: var(--text-main);
    }

    /* ---------- BIG-SCREEN MODE ---------- */

    body.mode-big .question-panel {
      flex: 1 0 0;
    }

    body.mode-big .answers-panel {
      flex: 1 0 0;
    }

    body.mode-big .question-text {
      font-size: clamp(1.6rem, 3.2vw, 3.4rem);
    }

    body.mode-big .answer-button {
      font-size: clamp(1.2rem, 2.4vw, 2.6rem);
      height: 100%;
    }

    /* Big-screen layout: timer | question | emoji */
    body.mode-big .question-panel {
    justify-content: center;
    }

    body.mode-big .question-layout {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    gap: 24px;
    }

    body.mode-big .question-side {
    flex: 0 0 140px; /* fixed side columns */
    display: flex;
    align-items: center;
    justify-content: center;
    }

    body.mode-big .question-card {
    flex: 0 0 60%; /* center block takes ~60% width */
    }



    body.mode-big .answers-grid {
      grid-auto-rows: 1fr;
    }

    /* ---------- PHONE MODE ---------- */

    body.mode-phone .quiz-main {
      gap: 6px;
    }

    body.mode-phone .question-panel {
      flex: 0 0 auto;
    }

    body.mode-phone .answers-panel {
      flex: 1 0 auto;
    }

    body.mode-phone .question-card {
      padding: 10px 12px;
    }

    body.mode-phone .question-text {
      font-size: clamp(1rem, 2.5vh, 1.5rem);
    }

    body.mode-phone .answers-grid {
      grid-template-columns: 1fr;
      grid-auto-rows: auto;
      gap: 8px;
    }

    body.mode-phone .answer-button {
      font-size: clamp(0.9rem, 2.2vh, 1.1rem);
      padding: 10px 12px;
    }

    /* ---------- FULLSCREEN TWEAKS ---------- */

    :fullscreen .question-text,
    :-webkit-full-screen .question-text {
      font-size: clamp(2.2rem, 4vw, 5rem);
    }

    :fullscreen body.mode-big .answer-button,
    :-webkit-full-screen body.mode-big .answer-button {
       font-size: clamp(1.2rem, 2.4vw, 2.6rem);
    }

    /* ---------- FEEDBACK OVERLAY + STARS ---------- */

    #feedback-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      pointer-events: none;
    }

    #feedback-overlay.visible {
      display: flex;
    }

    .feedback-inner {
      background: rgba(15,23,42,0.8);
      border-radius: 999px;
      padding: 18px 24px;
      text-align: center;
      color: #ffffff;
      max-width: 90%;
      box-shadow: 0 20px 45px rgba(15,23,42,0.8);
    }

    .feedback-title {
      font-size: clamp(2rem, 3.5vw, 3.2rem);
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .feedback-title.correct-text { color: #a7cb6f; }
    .feedback-title.incorrect-text { color: #ff5a51; }

    .feedback-detail {
      font-size: clamp(1rem, 1.8vw, 1.3rem);
      margin-top: 4px;
    }

    .star {
      position: fixed;
      top: -40px;
      font-size: clamp(1.6rem, 2.6vw, 2.2rem);
      animation: fall 1.2s linear forwards;
      z-index: 60;
      pointer-events: none;
    }

    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    /* ---------- END SCREEN ---------- */

    /* Make the end screen center vertically */
    .card-header {
    flex: 1;
    display: flex;
    }


    .end-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      text-align: center;
    }

    .end-trophy {
      font-size: clamp(3rem, 6vw, 4rem);
    }

    .end-score {
      font-size: clamp(2.2rem, 3.3vw, 3rem);
      font-weight: 800;
      color: var(--accent-dark);
    }

    .end-detail {
      font-size: clamp(1.05rem, 1.8vw, 1.3rem);
      color: var(--text-muted);
    }

    .end-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 12px;
    }

    #end-screen.end-great {
      background: radial-gradient(circle at top, #fef9c3, #bbf7d0);
    }

    #end-screen.end-good {
      background: radial-gradient(circle at top, #dbeafe, #cffafe);
    }

    #end-screen.end-try {
      background: radial-gradient(circle at top, #fee2e2, #fef3c7);
    }
  </style>
</head>
<body class="mode-title">
  <div id="app">

    <!-- INTRO SCREEN -->
    <div id="intro-screen" class="screen-card">
      <div class="intro-content">
        <div class="intro-line intro-line-1">Presented by</div>
        <div class="intro-line intro-line-2">eatyourbible.com</div>
      </div>
    </div>

    
    <!-- TITLE SCREEN -->
    <div id="title-screen" class="screen-card">
      <div id="title-screen-content">
        <div class="lesson-image-wrapper">
          <img
            id="lesson-image"
            class="lesson-image"
            src="quizimages/ot01image.png"
            alt="Lesson image"
          />
        </div>
        <div>
          <h1 id="lesson-title" class="card-title">Sample Devotional Quiz</h1>
          <p id="lesson-subtitle" class="card-subtitle">
            10 questions to see how well you know the story!
          </p>
        </div>
        <div class="mode-buttons">
          <button id="big-screen-btn" class="primary-button">
            <span>Big-Screen Mode</span> <span>üì∫</span>
          </button>
          <button id="phone-mode-btn" class="secondary-button">
            <span>Phone Mode</span> <span>üì±</span>
          </button>
        </div>
       <p class="mode-note">
  Big-Screen Mode is best for TVs and computers.<br>
  Phone Mode is sized to fit smaller screens.
</p>

      </div>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quiz-screen" class="screen-card hidden">
      <div class="top-bar">
        <span>Question <strong id="question-number">1</strong> of <strong id="total-questions">10</strong></span>
        <button id="sound-toggle" class="sound-toggle" aria-label="Toggle sound">üîä</button>
      </div>
      <div class="progress-track">
        <div id="progress-fill" class="progress-fill"></div>
      </div>

      <div class="quiz-main">
        <div class="question-panel">
        <div class="question-layout">
            <!-- LEFT: Timer ring (big-screen only) -->
            <div class="question-side question-timer">
            <div class="timer-ring-wrapper">
                <svg class="timer-svg" viewBox="0 0 120 120">
                <circle
                    class="timer-ring-bg"
                    cx="60"
                    cy="60"
                    r="54"
                ></circle>
                <circle
                    id="timer-ring-fg"
                    class="timer-ring-fg"
                    cx="60"
                    cy="60"
                    r="54"
                ></circle>
                </svg>
                <div id="timer-text" class="timer-text">30</div>
            </div>
            </div>

            <!-- CENTER: Question -->
            <div class="question-card">
            <div id="question-text" class="question-text">
                Question text here
            </div>
            </div>

            <!-- RIGHT: Emoji host -->
            <div class="question-side question-emoji">
            <div id="emoji-face" class="emoji-face">üòÄ</div>
            </div>
        </div>
        </div>


        <div class="answers-panel">
          <div class="answers-grid" id="answers-grid">
            <button class="answer-button color-red" data-button-index="0">
              <span class="answer-text"></span>
            </button>
            <button class="answer-button color-yellow" data-button-index="1">
              <span class="answer-text"></span>
            </button>
            <button class="answer-button color-blue" data-button-index="2">
              <span class="answer-text"></span>
            </button>
            <button class="answer-button color-green" data-button-index="3">
              <span class="answer-text"></span>
            </button>
          </div>

          <div class="score-row">
            <span>Score: <strong id="score-display">0</strong></span>
            <span>Streak: <strong id="streak-display">x0</strong></span>
          </div>
        </div>
      </div>
    </div>

    <!-- END SCREEN -->
    <div id="end-screen" class="screen-card hidden">
      <div class="card-header">
        <div class="end-main">
          <div class="end-trophy" id="end-trophy">üèÜ</div>
          <h2 class="card-title" id="end-title">Quiz Complete!</h2>
          <p class="card-subtitle" id="end-subtitle">Here&rsquo;s how you did</p>
          <div class="end-score" id="final-score">0 points</div>
          <div class="end-detail" id="final-correct">
            You got 0 out of 10 correct
          </div>
          <div class="end-buttons">
            <button id="play-again-btn" class="primary-button">Play Again</button>
            <button id="back-to-title-btn" class="secondary-button">Back to Title</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FEEDBACK OVERLAY -->
  <div id="feedback-overlay">
    <div class="feedback-inner">
      <div id="feedback-title" class="feedback-title">CORRECT</div>
      <div id="feedback-detail" class="feedback-detail"></div>
    </div>
  </div>

  <script>
    /***********************
     * CONFIG
     ***********************/
    const LESSON_ID = "ot01";
    const LESSON_TITLE_TEXT = "God Creates the World";
    const LESSON_SUBTITLE_TEXT = "Test how well you know this story";
    const LESSON_IMAGE_PATH = `quizimages/${LESSON_ID}image.png`;

    const QUESTIONS = [
      {
        text: "What did God create on day one?",
        answers: [
          "The heavens and the earth and light",
          "The sky and the sea",
          "Dry land and plants",
          "Sun, moon, and stars"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day two?",
        answers: [
          "He separated the sky and the sea",
          "Dry land and plants",
          "Birds and fish",
          "Land animals and human beings"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day three?",
        answers: [
          "Dry land and plants",
          "The sky and the sea",
          "Sun, moon, and stars",
          "Birds and fish"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day four?",
        answers: [
          "Sun, moon, and stars",
          "Dry land and plants",
          "Land animals and people",
          "Birds and fish"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day five?",
        answers: [
          "Birds and fish",
          "The sky and the sea",
          "Land animals and people",
          "Sun, moon, and stars"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day six?",
        answers: [
          "Land animals and human beings",
          "Birds and fish",
          "Dry land and plants",
          "Nothing, He rested"
        ],
        correctIndex: 0
      },
      {
        text: "How are human beings different than everything else God made?",
        answers: [
          "We‚Äôre made in His likeness and given the job to rule over His creation",
          "We can swim and fly better than all animals",
          "We were created before light and water",
          "We live under the sea like fish"
        ],
        correctIndex: 0
      },
      {
        text: "What did God create on day seven?",
        answers: [
          "Nothing, He rested",
          "Birds and fish",
          "The sky and the sea",
          "Sun, moon, and stars"
        ],
        correctIndex: 0
      },
      {
        text: "How did God create everything?",
        answers: [
          "Out of nothing, just by speaking",
          "By using tools and machines",
          "By asking the angels to build it",
          "By finding pieces that were already there"
        ],
        correctIndex: 0
      },
      {
        text: "What did God say after seeing everything He made?",
        answers: [
          "It was very good",
          "It was almost good enough",
          "It needed to be fixed later",
          "He wasn‚Äôt sure He liked it"
        ],
        correctIndex: 0
      }
    ];

    /***********************
     * STATE
     ***********************/
    let currentMode = "phone"; // "big" or "phone"
    let currentQuestionIndex = 0;
    let score = 0;
    let streak = 0;
    let correctCount = 0;
    let soundEnabled = true;
    let isLocked = false;

    let audioCtx = null;

    const TIMER_DURATION = 30;
    const TIMER_RADIUS = 54;
    const TIMER_CIRCUMFERENCE = 2 * Math.PI * TIMER_RADIUS;

    let timeLeft = TIMER_DURATION;
    let timerIntervalId = null;

    const NEUTRAL_EMOJIS = ["üòÄ","üòÑ","üòä","üòÅ","ü§ó","üôÇ","ü§©","üòé"];
    const CORRECT_EMOJIS = ["ü§©","üòÑ","üôå","üéâ","‚ú®"];
    const INCORRECT_EMOJIS = ["üò¢","üòÆ","üòî"];

    let emojiIntervalId = null;
    let emojiLockedUntil = 0;


    /***********************
     * DOM
     ***********************/
    const body = document.body;

    const introScreen = document.getElementById("intro-screen");
    const titleScreen = document.getElementById("title-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const endScreen = document.getElementById("end-screen");


    const bigScreenBtn = document.getElementById("big-screen-btn");
    const phoneModeBtn = document.getElementById("phone-mode-btn");

    const lessonImageEl = document.getElementById("lesson-image");
    const lessonTitleEl = document.getElementById("lesson-title");
    const lessonSubtitleEl = document.getElementById("lesson-subtitle");

    const questionNumberEl = document.getElementById("question-number");
    const totalQuestionsEl = document.getElementById("total-questions");
    const progressFillEl = document.getElementById("progress-fill");

    const questionTextEl = document.getElementById("question-text");
    const answerButtons = Array.from(document.querySelectorAll(".answer-button"));

    const timerTextEl = document.getElementById("timer-text");
    const timerRingFgEl = document.getElementById("timer-ring-fg");
    const emojiFaceEl = document.getElementById("emoji-face");


    const scoreDisplayEl = document.getElementById("score-display");
    const streakDisplayEl = document.getElementById("streak-display");

    const feedbackOverlay = document.getElementById("feedback-overlay");
    const feedbackTitleEl = document.getElementById("feedback-title");
    const feedbackDetailEl = document.getElementById("feedback-detail");

    const soundToggleBtn = document.getElementById("sound-toggle");

    const finalScoreEl = document.getElementById("final-score");
    const finalCorrectEl = document.getElementById("final-correct");
    const endTitleEl = document.getElementById("end-title");
    const endSubtitleEl = document.getElementById("end-subtitle");
    const endTrophyEl = document.getElementById("end-trophy");
    const playAgainBtn = document.getElementById("play-again-btn");
    const backToTitleBtn = document.getElementById("back-to-title-btn");

    totalQuestionsEl.textContent = QUESTIONS.length.toString();
    lessonImageEl.src = LESSON_IMAGE_PATH;
    lessonTitleEl.textContent = LESSON_TITLE_TEXT;
    lessonSubtitleEl.textContent = LESSON_SUBTITLE_TEXT;

    /***********************
     * AUDIO
     ***********************/
    function getAudioContext() {
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC) {
          audioCtx = new AC();
        }
      }
      return audioCtx;
    }

    function playBeepSequence(notes) {
      if (!soundEnabled) return;
      const ctx = getAudioContext();
      if (!ctx) return;
      const now = ctx.currentTime;
      notes.forEach((note, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.type = "triangle";
        osc.frequency.value = note.freq;
        const t0 = now + i * note.duration;
        const t1 = t0 + note.duration;
        gain.gain.setValueAtTime(0, t0);
        gain.gain.linearRampToValueAtTime(0.45, t0 + 0.02);
        gain.gain.linearRampToValueAtTime(0.0, t1);
        osc.start(t0);
        osc.stop(t1 + 0.02);
      });
    }

    function playCorrectSound() {
      playBeepSequence([
        { freq: 660, duration: 0.14 },
        { freq: 880, duration: 0.14 },
        { freq: 1040, duration: 0.16 }
      ]);
    }

    function playIncorrectSound() {
      playBeepSequence([
        { freq: 260, duration: 0.18 },
        { freq: 200, duration: 0.20 }
      ]);
    }

    /***********************
     * HELPERS
     ***********************/
    function shuffledIndices(n) {
      const arr = Array.from({ length: n }, (_, i) => i);
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function showScreen(screenName) {
      // Hide all screens first
      introScreen.classList.add("hidden");
      titleScreen.classList.add("hidden");
      quizScreen.classList.add("hidden");
      endScreen.classList.add("hidden");

      if (screenName === "intro") {
        introScreen.classList.remove("hidden");
      } else if (screenName === "title") {
        titleScreen.classList.remove("hidden");
      } else if (screenName === "quiz") {
        quizScreen.classList.remove("hidden");
      } else if (screenName === "end") {
        endScreen.classList.remove("hidden");
      }
    }


    function updateScoreDisplays() {
      scoreDisplayEl.textContent = score.toString();
      streakDisplayEl.textContent = "x" + streak.toString();
    }

    function updateProgress() {
      const n = currentQuestionIndex;
      const pct = (n / QUESTIONS.length) * 100;
      progressFillEl.style.width = pct + "%";
      questionNumberEl.textContent = (n + 1).toString();
    }

    function spawnStarRain(count) {
      for (let i = 0; i < count; i++) {
        const star = document.createElement("div");
        star.className = "star";
        star.textContent = "‚≠ê";
        star.style.left = Math.random() * 100 + "vw";
        star.style.animationDelay = Math.random() * 0.5 + "s";
        document.body.appendChild(star);
        star.addEventListener("animationend", () => star.remove());
      }
    }

    function updateTimerVisual() {
      if (!timerRingFgEl || !timerTextEl) return;
      const ratio = Math.max(0, Math.min(1, timeLeft / TIMER_DURATION));
      const offset = TIMER_CIRCUMFERENCE * (1 - ratio);

      timerRingFgEl.style.strokeDasharray = String(TIMER_CIRCUMFERENCE);
      timerRingFgEl.style.strokeDashoffset = String(offset);
      timerTextEl.textContent = String(timeLeft);
    }

    function stopTimer() {
      if (timerIntervalId !== null) {
        clearInterval(timerIntervalId);
        timerIntervalId = null;
      }
    }

    function startTimer() {
      stopTimer();
      timeLeft = TIMER_DURATION;
      updateTimerVisual();

      // Only actually run timer in big-screen mode
      if (currentMode !== "big") return;

      timerIntervalId = setInterval(() => {
        if (timeLeft > 0) {
          timeLeft -= 1;
          updateTimerVisual();
        } else {
          // Time's up: stop counting, but don't auto-answer.
          stopTimer();
        }
      }, 1000);
    }

    function setEmojiFromSet(list) {
      if (!emojiFaceEl || !list.length) return;
      const next = list[Math.floor(Math.random() * list.length)];
      emojiFaceEl.textContent = next;

      // small pop animation
      emojiFaceEl.classList.add("emoji-pop");
      setTimeout(() => {
        emojiFaceEl && emojiFaceEl.classList.remove("emoji-pop");
      }, 200);
    }

    function startEmojiLoop() {
      if (!emojiFaceEl) return;
      if (emojiIntervalId !== null) clearInterval(emojiIntervalId);

      // Start with a random neutral face
      setEmojiFromSet(NEUTRAL_EMOJIS);

      emojiIntervalId = setInterval(() => {
        const now = Date.now();
        if (now < emojiLockedUntil) return; // temporarily locked for answer reaction
        setEmojiFromSet(NEUTRAL_EMOJIS);
      }, 3000);
    }

    function showEmojiReaction(isCorrect) {
      const set = isCorrect ? CORRECT_EMOJIS : INCORRECT_EMOJIS;
      emojiLockedUntil = Date.now() + 2000; // lock for ~2 seconds
      setEmojiFromSet(set);
    }


    function showFeedback(isCorrect, detailText) {
      feedbackTitleEl.textContent = isCorrect ? "CORRECT" : "INCORRECT";
      feedbackTitleEl.classList.toggle("correct-text", isCorrect);
      feedbackTitleEl.classList.toggle("incorrect-text", !isCorrect);
        if (detailText) {
        feedbackDetailEl.textContent = detailText;
        feedbackDetailEl.style.display = "block";
        } else {
        feedbackDetailEl.textContent = "";
        feedbackDetailEl.style.display = "none";
        }

      feedbackOverlay.classList.add("visible");
      setTimeout(() => {
        feedbackOverlay.classList.remove("visible");
      }, 2000);
    }

    function requestFullscreenIfAvailable() {
      const docEl = document.documentElement;
      const request =
        docEl.requestFullscreen ||
        docEl.webkitRequestFullscreen ||
        docEl.msRequestFullscreen;
      if (request) {
        try {
          request.call(docEl);
        } catch (e) {
          // ignore; some browsers (esp. iOS) just won't do it
        }
      }
    }

    /***********************
     * GAME FLOW
     ***********************/
    function startGame(mode) {
      currentMode = mode;
      body.classList.remove("mode-title", "mode-big", "mode-phone");
      if (mode === "big") {
        body.classList.add("mode-big");
        requestFullscreenIfAvailable();
      } else {
        body.classList.add("mode-phone");
        // We still try fullscreen; on iOS this may be ignored.
        requestFullscreenIfAvailable();
      }

      startEmojiLoop();

      currentQuestionIndex = 0;
      score = 0;
      streak = 0;
      correctCount = 0;
      updateScoreDisplays();
      updateProgress();
      showScreen("quiz");
      loadQuestion();
    }

    function loadQuestion() {
      if (currentQuestionIndex >= QUESTIONS.length) {
        endGame();
        return;
      }

      const q = QUESTIONS[currentQuestionIndex];
      questionTextEl.textContent = q.text;
      updateProgress();

      // Reset timer for each new question
      if (currentMode === "big") {
        startTimer();
      } else {
        stopTimer();
      }
    

      isLocked = false;
      answerButtons.forEach(btn => {
        // Remove any state from the previous question
        btn.classList.remove("disabled", "answer-correct", "answer-wrong", "answer-faded");
      });

      const order = shuffledIndices(q.answers.length);
      answerButtons.forEach((btn, pos) => {
        const idx = order[pos];
        btn.dataset.answerIndex = String(idx);
        const textSpan = btn.querySelector(".answer-text");
        textSpan.textContent = q.answers[idx];
      });
    }



    function handleAnswerClick(e) {
      if (isLocked) return;
      isLocked = true;

      // Stop timer as soon as an answer is chosen
      stopTimer();

      const btn = e.currentTarget;
      const answerIndex = Number(btn.dataset.answerIndex);
      const q = QUESTIONS[currentQuestionIndex];

      // Stop any more clicks on the answers
      answerButtons.forEach(b => b.classList.add("disabled"));

      const isCorrect = answerIndex === q.correctIndex;


      if (isCorrect) {
        // Visually mark the chosen answer as correct
        btn.classList.add("answer-correct");

        // Time-based bonus (big-screen mode only)
        let timeBonus = 0;
        if (currentMode === "big") {
          timeBonus = timeLeft * 5; // 5 points per remaining second
        }

        streak += 1;
        const base = 100 * streak;
        const earned = base + timeBonus;
        score += earned;
        correctCount += 1;
        updateScoreDisplays();
        playCorrectSound();
        spawnStarRain(20);
        showEmojiReaction(true);

        const msg = currentMode === "big"
          ? `Streak: ${streak} in a row! +${earned} points (time bonus: +${timeBonus})`
          : `Streak: ${streak} in a row! +${earned} points`;

        showFeedback(true, msg);
      } else {
        // Incorrect answer:
        //  - Grey out all 3 wrong answers
        //  - Keep only the correct one in full color

        answerButtons.forEach(b => {
          const bIndex = Number(b.dataset.answerIndex);
          if (bIndex === q.correctIndex) {
            // This is the correct answer: highlight it
            b.classList.add("answer-correct");
            b.classList.remove("answer-faded");
          } else {
            // These are wrong answers: fade them out
            b.classList.add("answer-faded");
            b.classList.remove("answer-correct");
          }
        });

        streak = 0;
        updateScoreDisplays();
        playIncorrectSound();
        showEmojiReaction(false);
        showFeedback(false, "");
      }


      // Move to the next question after a short pause
      setTimeout(() => {
        currentQuestionIndex += 1;
        loadQuestion();
      }, 2500);
    }



    function endGame() {
      updateProgress();
      finalScoreEl.textContent = `${score} points`;
      finalCorrectEl.textContent = `You got ${correctCount} out of ${QUESTIONS.length} correct`;

      const ratio = correctCount / QUESTIONS.length;
      endScreen.classList.remove("end-great", "end-good", "end-try");

      if (ratio >= 0.8) {
        endScreen.classList.add("end-great");
        endTitleEl.textContent = "Amazing Job!";
        endSubtitleEl.textContent = "You really know this story.";
        endTrophyEl.textContent = "üèÜ";
        spawnStarRain(30);
      } else if (ratio >= 0.5) {
        endScreen.classList.add("end-good");
        endTitleEl.textContent = "Nice Work!";
        endSubtitleEl.textContent = "You did well. Keep learning!";
        endTrophyEl.textContent = "üéâ";
      } else {
        endScreen.classList.add("end-try");
        endTitleEl.textContent = "Keep Practicing!";
        endSubtitleEl.textContent = "Try again and watch your score grow.";
        endTrophyEl.textContent = "‚≠ê";
      }

      showScreen("end");
    }

    /***********************
     * EVENT LISTENERS
     ***********************/
    bigScreenBtn.addEventListener("click", () => startGame("big"));
    phoneModeBtn.addEventListener("click", () => startGame("phone"));

    answerButtons.forEach(btn => {
      btn.addEventListener("click", handleAnswerClick);
    });

    soundToggleBtn.addEventListener("click", () => {
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "üîä" : "üîà";
    });

    playAgainBtn.addEventListener("click", () => startGame(currentMode));
    backToTitleBtn.addEventListener("click", () => {
      body.classList.remove("mode-big", "mode-phone");
      body.classList.add("mode-title");
      showScreen("title");
    });

    // Start on intro screen with full black background
    body.classList.add("mode-title");
    body.classList.add("intro-mode");
    showScreen("intro");

    // After 4 seconds, start fading out the intro
    setTimeout(() => {
      introScreen.classList.add("intro-fade-out");
    }, 4000);

    // After 5 seconds total, remove intro and show the title screen
    setTimeout(() => {
      body.classList.remove("intro-mode");
      showScreen("title");
      introScreen.classList.remove("intro-fade-out");
    }, 5000);


  </script>
</body>
</html>
